{"ast":null,"code":"import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createRef,useEffect,useRef,useState}from\"react\";import{useGlobalActions,useGlobalState}from\"../context/globalContext\";import{jsx as _jsx}from\"react/jsx-runtime\";var Creature=function Creature(props){var _useGlobalState=useGlobalState(),status=_useGlobalState.status,speed=_useGlobalState.speed,calamities=_useGlobalState.calamities,resources=_useGlobalState.resources,totalPopulation=_useGlobalState.totalPopulation;var creatureRef=useRef(null);var size=useRef(props.size?props.size:6);var _useState=useState(props.birth+10000>Date.now()?\"#44FFE3\":props.gender.localeCompare(\"M\")===0?\"#E8FF95\":\"#FF4489\"),_useState2=_slicedToArray(_useState,2),color=_useState2[0],setColor=_useState2[1];var _useState3=useState(props.birth+10000>Date.now()?\"babyCreature\":\"adultCreature\"),_useState4=_slicedToArray(_useState3,2),className=_useState4[0],setClassName=_useState4[1];var _useState5=useState({x:props.x?props.x:Math.floor((props.dim.w-20)*Math.random()-size.current/2+10),y:props.y?props.y:Math.floor((props.dim.h-20)*Math.random()-size.current/2+10)}),_useState6=_slicedToArray(_useState5,2),position=_useState6[0],setPosition=_useState6[1];function increaseSize(){size.current=10;}//destroy self\nfunction selfDestroy(){var _props$earthRef,_props$earthRef$curre;var event=new CustomEvent(\"death\",{detail:{uid:props.uid}});(_props$earthRef=props.earthRef)===null||_props$earthRef===void 0?void 0:(_props$earthRef$curre=_props$earthRef.current)===null||_props$earthRef$curre===void 0?void 0:_props$earthRef$curre.dispatchEvent(event);}function destroyNeighbour(neighbourUID){var _props$earthRef2,_props$earthRef2$curr;var event=new CustomEvent(\"death\",{detail:{uid:neighbourUID}});(_props$earthRef2=props.earthRef)===null||_props$earthRef2===void 0?void 0:(_props$earthRef2$curr=_props$earthRef2.current)===null||_props$earthRef2$curr===void 0?void 0:_props$earthRef2$curr.dispatchEvent(event);}//check if there is any calamity nearby\nfunction checkCalamity(){if(calamities.length>0){for(var i=0;i<calamities.length;i++){var xDiff=Math.abs(position.x+size.current/2-calamities[i].position.x);var yDiff=Math.abs(position.y+size.current/2-calamities[i].position.y);var distance=Math.sqrt(Math.pow(xDiff,2)+Math.pow(yDiff,2));if(distance<calamities[i].size){selfDestroy();}}}}//check if there is any water body nearby\nfunction checkResources(){if(resources.length>0){for(var i=0;i<resources.length;i++){var xDiff=Math.abs(position.x+size.current/2-resources[i].position.x);var yDiff=Math.abs(position.y+size.current/2-resources[i].position.y);var distance=Math.sqrt(Math.pow(xDiff,2)+Math.pow(yDiff,2));if(distance<resources[i].size/2+30){if(distance<resources[i].size/2){//do something here asumming the creature becomes wwater animal\n}else{increaseSize();}}}}}function changeColor(){if(props.birth+10000<Date.now()&&color.localeCompare(\"#44FFE3\")===0)setColor(props.gender.localeCompare(\"M\")===0?\"#E8FF95\":\"#FF4489\");}function changeClassName(){if(props.birth+10000<Date.now()&&className.localeCompare(\"babyCreature\")===0)setClassName(\"adultCreature\");}function canReproduce(){if(className.localeCompare(\"adultCreature\")===0){return true;}else{return false;}}function checkIfOldEnoughToDie(){if(Date.now()>props.birth+50000&&Math.random()>0.97){selfDestroy();}}//change position randomly *update to tendency based position change*\nfunction changePosition(){var pos=[1,-1];var skipX=Math.floor(Math.random()*speed);var skipY=Math.floor(Math.random()*speed);var plusMinusX=Math.floor(Math.random()*2);var plusMinusY=Math.floor(Math.random()*2);var newPosition={x:position.x+pos[plusMinusX]*skipX,y:position.y+pos[plusMinusY]*skipY};if(newPosition.x+size.current+10>props.dim.w){newPosition.x=props.dim.w-size.current-10;}if(newPosition.y+size.current+10>props.dim.h){newPosition.y=props.dim.h-size.current-10;}if(newPosition.x<10){newPosition.x=10;}if(newPosition.y<10){newPosition.y=10;}setPosition(newPosition);}//get all neighbouring adults\nfunction getNeighbourHood(){var maleNeighbours=[];var femaleNeighbours=[];if(creatureRef===null||creatureRef===void 0?void 0:creatureRef.current){var _creatureRef$current,_creatureRef$current$;var children=(_creatureRef$current=creatureRef.current)===null||_creatureRef$current===void 0?void 0:(_creatureRef$current$=_creatureRef$current.parentNode)===null||_creatureRef$current$===void 0?void 0:_creatureRef$current$.childNodes;if(children){Object.keys(children).forEach(function(key){var _children$key;if(((_children$key=children[key])===null||_children$key===void 0?void 0:_children$key.className.localeCompare(\"adultCreature\"))===0&&Math.abs(children[key].offsetLeft-position.x)<10&&Math.abs(children[key].offsetTop-position.y)<10&&children[key].id.localeCompare(props.uid)!==0){if(children[key].id[0].localeCompare(\"F\")===0){femaleNeighbours.push(children[key]);}else{maleNeighbours.push(children[key]);}}});}}var neighbourHood={maleNeighbours:maleNeighbours,femaleNeighbours:femaleNeighbours};return neighbourHood;}//send birth request to earth\nfunction birthRequest(neighbour){var _props$earthRef3,_props$earthRef3$curr;var mother={id:props.uid,position:position,size:size.current};var father={id:neighbour.id,position:{x:neighbour.offsetLeft,y:neighbour.offsetTop},size:neighbour.clientWidth};var event=new CustomEvent(\"birth\",{detail:{mother:mother,father:father}});(_props$earthRef3=props.earthRef)===null||_props$earthRef3===void 0?void 0:(_props$earthRef3$curr=_props$earthRef3.current)===null||_props$earthRef3$curr===void 0?void 0:_props$earthRef3$curr.dispatchEvent(event);}//regular activity function\nfunction doActivities(){checkIfOldEnoughToDie();checkCalamity();checkResources();changePosition();changeColor();changeClassName();var _getNeighbourHood=getNeighbourHood(),maleNeighbours=_getNeighbourHood.maleNeighbours,femaleNeighbours=_getNeighbourHood.femaleNeighbours;if(props.uid[0].localeCompare(\"F\")===0){if(canReproduce()&&maleNeighbours.length>0){birthRequest(maleNeighbours[0]);}}else{if(maleNeighbours.length>0&&maleNeighbours[0].clientWidth<size.current){destroyNeighbour(maleNeighbours[0].id);}}}useEffect(function(){if(status.localeCompare(\"Playing\")===0){var interval=setInterval(function(){doActivities();},Math.floor(Math.random()*500)+10);return function(){clearInterval(interval);};}},[position,status,speed]);return/*#__PURE__*/_jsx(\"div\",{className:className,ref:creatureRef,id:props.uid,style:{borderRadius:size.current/2,height:size.current,width:size.current,backgroundColor:color,position:\"absolute\",top:position.y,left:position.x,transition:\"all 0.5s ease-in-out\",WebkitBoxShadow:props.birth+10000>Date.now()?\"0 0 10px #44FFE3\":\"none\",boxShadow:props.birth+10000>Date.now()?\"0 0 10px #44FFE3\":\"none\"}});};export default Creature;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/creature.js"],"names":["createRef","useEffect","useRef","useState","useGlobalActions","useGlobalState","Creature","props","status","speed","calamities","resources","totalPopulation","creatureRef","size","birth","Date","now","gender","localeCompare","color","setColor","className","setClassName","x","Math","floor","dim","w","random","current","y","h","position","setPosition","increaseSize","selfDestroy","event","CustomEvent","detail","uid","earthRef","dispatchEvent","destroyNeighbour","neighbourUID","checkCalamity","length","i","xDiff","abs","yDiff","distance","sqrt","pow","checkResources","changeColor","changeClassName","canReproduce","checkIfOldEnoughToDie","changePosition","pos","skipX","skipY","plusMinusX","plusMinusY","newPosition","getNeighbourHood","maleNeighbours","femaleNeighbours","children","parentNode","childNodes","Object","keys","forEach","key","offsetLeft","offsetTop","id","push","neighbourHood","birthRequest","neighbour","mother","father","clientWidth","doActivities","interval","setInterval","clearInterval","borderRadius","height","width","backgroundColor","top","left","transition","WebkitBoxShadow","boxShadow"],"mappings":"wJAAA,OAASA,SAAT,CAAoBC,SAApB,CAA+BC,MAA/B,CAAuCC,QAAvC,KAAuD,OAAvD,CACA,OAASC,gBAAT,CAA2BC,cAA3B,KAAiD,0BAAjD,C,2CAMA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,KAAD,CAAW,qBACuCF,cAAc,EADrD,CAClBG,MADkB,iBAClBA,MADkB,CACVC,KADU,iBACVA,KADU,CACHC,UADG,iBACHA,UADG,CACSC,SADT,iBACSA,SADT,CACoBC,eADpB,iBACoBA,eADpB,CAE1B,GAAMC,CAAAA,WAAW,CAAGX,MAAM,CAAC,IAAD,CAA1B,CACA,GAAMY,CAAAA,IAAI,CAAGZ,MAAM,CAACK,KAAK,CAACO,IAAN,CAAaP,KAAK,CAACO,IAAnB,CAA0B,CAA3B,CAAnB,CAH0B,cAIAX,QAAQ,CAChCI,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,CACI,SADJ,CAEIV,KAAK,CAACW,MAAN,CAAaC,aAAb,CAA2B,GAA3B,IAAoC,CAApC,CACA,SADA,CAEA,SAL4B,CAJR,wCAInBC,KAJmB,eAIZC,QAJY,8BAWQlB,QAAQ,CACxCI,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,CAAmC,cAAnC,CAAoD,eADZ,CAXhB,yCAWnBK,SAXmB,eAWRC,YAXQ,8BAcMpB,QAAQ,CAAC,CACvCqB,CAAC,CAAEjB,KAAK,CAACiB,CAAN,CACCjB,KAAK,CAACiB,CADP,CAECC,IAAI,CAACC,KAAL,CAAW,CAACnB,KAAK,CAACoB,GAAN,CAAUC,CAAV,CAAc,EAAf,EAAqBH,IAAI,CAACI,MAAL,EAArB,CAAqCf,IAAI,CAACgB,OAAL,CAAe,CAApD,CAAwD,EAAnE,CAHmC,CAIvCC,CAAC,CAAExB,KAAK,CAACwB,CAAN,CACCxB,KAAK,CAACwB,CADP,CAECN,IAAI,CAACC,KAAL,CAAW,CAACnB,KAAK,CAACoB,GAAN,CAAUK,CAAV,CAAc,EAAf,EAAqBP,IAAI,CAACI,MAAL,EAArB,CAAqCf,IAAI,CAACgB,OAAL,CAAe,CAApD,CAAwD,EAAnE,CANmC,CAAD,CAdd,yCAcnBG,QAdmB,eAcTC,WAdS,eAuB1B,QAASC,CAAAA,YAAT,EAAwB,CACtBrB,IAAI,CAACgB,OAAL,CAAe,EAAf,CACD,CAED;AACA,QAASM,CAAAA,WAAT,EAAuB,2CACrB,GAAMC,CAAAA,KAAK,CAAG,GAAIC,CAAAA,WAAJ,CAAgB,OAAhB,CAAyB,CACrCC,MAAM,CAAE,CAAEC,GAAG,CAAEjC,KAAK,CAACiC,GAAb,CAD6B,CAAzB,CAAd,CAGA,iBAAAjC,KAAK,CAACkC,QAAN,iFAAgBX,OAAhB,sEAAyBY,aAAzB,CAAuCL,KAAvC,EACD,CAED,QAASM,CAAAA,gBAAT,CAA0BC,YAA1B,CAAwC,4CACtC,GAAMP,CAAAA,KAAK,CAAG,GAAIC,CAAAA,WAAJ,CAAgB,OAAhB,CAAyB,CACrCC,MAAM,CAAE,CAAEC,GAAG,CAAEI,YAAP,CAD6B,CAAzB,CAAd,CAGA,kBAAArC,KAAK,CAACkC,QAAN,mFAAgBX,OAAhB,sEAAyBY,aAAzB,CAAuCL,KAAvC,EACD,CAED;AACA,QAASQ,CAAAA,aAAT,EAAyB,CACvB,GAAInC,UAAU,CAACoC,MAAX,CAAoB,CAAxB,CAA2B,CACzB,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGrC,UAAU,CAACoC,MAA/B,CAAuCC,CAAC,EAAxC,CAA4C,CAC1C,GAAMC,CAAAA,KAAK,CAAGvB,IAAI,CAACwB,GAAL,CACZhB,QAAQ,CAACT,CAAT,CAAaV,IAAI,CAACgB,OAAL,CAAe,CAA5B,CAAgCpB,UAAU,CAACqC,CAAD,CAAV,CAAcd,QAAd,CAAuBT,CAD3C,CAAd,CAGA,GAAM0B,CAAAA,KAAK,CAAGzB,IAAI,CAACwB,GAAL,CACZhB,QAAQ,CAACF,CAAT,CAAajB,IAAI,CAACgB,OAAL,CAAe,CAA5B,CAAgCpB,UAAU,CAACqC,CAAD,CAAV,CAAcd,QAAd,CAAuBF,CAD3C,CAAd,CAGA,GAAMoB,CAAAA,QAAQ,CAAG1B,IAAI,CAAC2B,IAAL,CAAU3B,IAAI,CAAC4B,GAAL,CAASL,KAAT,CAAgB,CAAhB,EAAqBvB,IAAI,CAAC4B,GAAL,CAASH,KAAT,CAAgB,CAAhB,CAA/B,CAAjB,CAEA,GAAIC,QAAQ,CAAGzC,UAAU,CAACqC,CAAD,CAAV,CAAcjC,IAA7B,CAAmC,CACjCsB,WAAW,GACZ,CACF,CACF,CACF,CAED;AACA,QAASkB,CAAAA,cAAT,EAA0B,CACxB,GAAI3C,SAAS,CAACmC,MAAV,CAAmB,CAAvB,CAA0B,CACxB,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGpC,SAAS,CAACmC,MAA9B,CAAsCC,CAAC,EAAvC,CAA2C,CACzC,GAAMC,CAAAA,KAAK,CAAGvB,IAAI,CAACwB,GAAL,CACZhB,QAAQ,CAACT,CAAT,CAAaV,IAAI,CAACgB,OAAL,CAAe,CAA5B,CAAgCnB,SAAS,CAACoC,CAAD,CAAT,CAAad,QAAb,CAAsBT,CAD1C,CAAd,CAGA,GAAM0B,CAAAA,KAAK,CAAGzB,IAAI,CAACwB,GAAL,CACZhB,QAAQ,CAACF,CAAT,CAAajB,IAAI,CAACgB,OAAL,CAAe,CAA5B,CAAgCnB,SAAS,CAACoC,CAAD,CAAT,CAAad,QAAb,CAAsBF,CAD1C,CAAd,CAIA,GAAMoB,CAAAA,QAAQ,CAAG1B,IAAI,CAAC2B,IAAL,CAAU3B,IAAI,CAAC4B,GAAL,CAASL,KAAT,CAAgB,CAAhB,EAAqBvB,IAAI,CAAC4B,GAAL,CAASH,KAAT,CAAgB,CAAhB,CAA/B,CAAjB,CAEA,GAAIC,QAAQ,CAAGxC,SAAS,CAACoC,CAAD,CAAT,CAAajC,IAAb,CAAoB,CAApB,CAAwB,EAAvC,CAA2C,CACzC,GAAIqC,QAAQ,CAAGxC,SAAS,CAACoC,CAAD,CAAT,CAAajC,IAAb,CAAoB,CAAnC,CAAsC,CACpC;AACD,CAFD,IAEO,CACLqB,YAAY,GACb,CACF,CACF,CACF,CACF,CAED,QAASoB,CAAAA,WAAT,EAAuB,CACrB,GACEhD,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,EACAG,KAAK,CAACD,aAAN,CAAoB,SAApB,IAAmC,CAFrC,CAIEE,QAAQ,CAACd,KAAK,CAACW,MAAN,CAAaC,aAAb,CAA2B,GAA3B,IAAoC,CAApC,CAAwC,SAAxC,CAAoD,SAArD,CAAR,CACH,CAED,QAASqC,CAAAA,eAAT,EAA2B,CACzB,GACEjD,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,EACAK,SAAS,CAACH,aAAV,CAAwB,cAAxB,IAA4C,CAF9C,CAIEI,YAAY,CAAC,eAAD,CAAZ,CACH,CAED,QAASkC,CAAAA,YAAT,EAAwB,CACtB,GAAInC,SAAS,CAACH,aAAV,CAAwB,eAAxB,IAA6C,CAAjD,CAAoD,CAClD,MAAO,KAAP,CACD,CAFD,IAEO,CACL,MAAO,MAAP,CACD,CACF,CAED,QAASuC,CAAAA,qBAAT,EAAgC,CAC9B,GAAG1C,IAAI,CAACC,GAAL,GAAWV,KAAK,CAACQ,KAAN,CAAY,KAAvB,EAA8BU,IAAI,CAACI,MAAL,GAAc,IAA/C,CAAoD,CAClDO,WAAW,GACZ,CACF,CACD;AACA,QAASuB,CAAAA,cAAT,EAA0B,CACxB,GAAMC,CAAAA,GAAG,CAAG,CAAC,CAAD,CAAI,CAAC,CAAL,CAAZ,CACA,GAAMC,CAAAA,KAAK,CAAGpC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACI,MAAL,GAAgBpB,KAA3B,CAAd,CACA,GAAMqD,CAAAA,KAAK,CAAGrC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACI,MAAL,GAAgBpB,KAA3B,CAAd,CAEA,GAAMsD,CAAAA,UAAU,CAAGtC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACI,MAAL,GAAgB,CAA3B,CAAnB,CACA,GAAMmC,CAAAA,UAAU,CAAGvC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACI,MAAL,GAAgB,CAA3B,CAAnB,CAEA,GAAMoC,CAAAA,WAAW,CAAG,CAClBzC,CAAC,CAAES,QAAQ,CAACT,CAAT,CAAaoC,GAAG,CAACG,UAAD,CAAH,CAAkBF,KADhB,CAElB9B,CAAC,CAAEE,QAAQ,CAACF,CAAT,CAAa6B,GAAG,CAACI,UAAD,CAAH,CAAkBF,KAFhB,CAApB,CAKA,GAAIG,WAAW,CAACzC,CAAZ,CAAgBV,IAAI,CAACgB,OAArB,CAA+B,EAA/B,CAAoCvB,KAAK,CAACoB,GAAN,CAAUC,CAAlD,CAAqD,CACnDqC,WAAW,CAACzC,CAAZ,CAAgBjB,KAAK,CAACoB,GAAN,CAAUC,CAAV,CAAcd,IAAI,CAACgB,OAAnB,CAA6B,EAA7C,CACD,CACD,GAAImC,WAAW,CAAClC,CAAZ,CAAgBjB,IAAI,CAACgB,OAArB,CAA+B,EAA/B,CAAoCvB,KAAK,CAACoB,GAAN,CAAUK,CAAlD,CAAqD,CACnDiC,WAAW,CAAClC,CAAZ,CAAgBxB,KAAK,CAACoB,GAAN,CAAUK,CAAV,CAAclB,IAAI,CAACgB,OAAnB,CAA6B,EAA7C,CACD,CACD,GAAImC,WAAW,CAACzC,CAAZ,CAAgB,EAApB,CAAwB,CACtByC,WAAW,CAACzC,CAAZ,CAAgB,EAAhB,CACD,CACD,GAAIyC,WAAW,CAAClC,CAAZ,CAAgB,EAApB,CAAwB,CACtBkC,WAAW,CAAClC,CAAZ,CAAgB,EAAhB,CACD,CAEDG,WAAW,CAAC+B,WAAD,CAAX,CACD,CAED;AACA,QAASC,CAAAA,gBAAT,EAA4B,CAE1B,GAAMC,CAAAA,cAAc,CAAG,EAAvB,CACA,GAAMC,CAAAA,gBAAgB,CAAG,EAAzB,CACA,GAAIvD,WAAJ,SAAIA,WAAJ,iBAAIA,WAAW,CAAEiB,OAAjB,CAA0B,gDACxB,GAAMuC,CAAAA,QAAQ,uBAAGxD,WAAW,CAACiB,OAAf,sEAAG,qBAAqBwC,UAAxB,gDAAG,sBAAiCC,UAAlD,CACA,GAAIF,QAAJ,CAAc,CACZG,MAAM,CAACC,IAAP,CAAYJ,QAAZ,EAAsBK,OAAtB,CAA8B,SAACC,GAAD,CAAS,mBACrC,GACE,gBAAAN,QAAQ,CAACM,GAAD,CAAR,sDAAerD,SAAf,CAAyBH,aAAzB,CAAuC,eAAvC,KAA4D,CAA5D,EACAM,IAAI,CAACwB,GAAL,CAASoB,QAAQ,CAACM,GAAD,CAAR,CAAcC,UAAd,CAA2B3C,QAAQ,CAACT,CAA7C,EAAkD,EADlD,EAEAC,IAAI,CAACwB,GAAL,CAASoB,QAAQ,CAACM,GAAD,CAAR,CAAcE,SAAd,CAA0B5C,QAAQ,CAACF,CAA5C,EAAiD,EAFjD,EAGAsC,QAAQ,CAACM,GAAD,CAAR,CAAcG,EAAd,CAAiB3D,aAAjB,CAA+BZ,KAAK,CAACiC,GAArC,IAA8C,CAJhD,CAKE,CACA,GAAG6B,QAAQ,CAACM,GAAD,CAAR,CAAcG,EAAd,CAAiB,CAAjB,EAAoB3D,aAApB,CAAkC,GAAlC,IAAyC,CAA5C,CAA8C,CAC5CiD,gBAAgB,CAACW,IAAjB,CAAsBV,QAAQ,CAACM,GAAD,CAA9B,EACD,CAFD,IAEK,CACFR,cAAc,CAACY,IAAf,CAAoBV,QAAQ,CAACM,GAAD,CAA5B,EACF,CACF,CACF,CAbD,EAcD,CACF,CAED,GAAMK,CAAAA,aAAa,CAAG,CAACb,cAAc,CAAdA,cAAD,CAAgBC,gBAAgB,CAAhBA,gBAAhB,CAAtB,CACA,MAAOY,CAAAA,aAAP,CACD,CAED;AACA,QAASC,CAAAA,YAAT,CAAsBC,SAAtB,CAAiC,4CAC/B,GAAMC,CAAAA,MAAM,CAAG,CAAEL,EAAE,CAAEvE,KAAK,CAACiC,GAAZ,CAAiBP,QAAQ,CAAEA,QAA3B,CAAqCnB,IAAI,CAAEA,IAAI,CAACgB,OAAhD,CAAf,CACA,GAAMsD,CAAAA,MAAM,CAAG,CACbN,EAAE,CAAEI,SAAS,CAACJ,EADD,CAEb7C,QAAQ,CAAE,CACRT,CAAC,CAAE0D,SAAS,CAACN,UADL,CAER7C,CAAC,CAAEmD,SAAS,CAACL,SAFL,CAFG,CAMb/D,IAAI,CAAEoE,SAAS,CAACG,WANH,CAAf,CASA,GAAMhD,CAAAA,KAAK,CAAG,GAAIC,CAAAA,WAAJ,CAAgB,OAAhB,CAAyB,CACrCC,MAAM,CAAE,CAAE4C,MAAM,CAANA,MAAF,CAAUC,MAAM,CAANA,MAAV,CAD6B,CAAzB,CAAd,CAGA,kBAAA7E,KAAK,CAACkC,QAAN,mFAAgBX,OAAhB,sEAAyBY,aAAzB,CAAuCL,KAAvC,EACD,CAED;AACA,QAASiD,CAAAA,YAAT,EAAwB,CACtB5B,qBAAqB,GACrBb,aAAa,GACbS,cAAc,GAEdK,cAAc,GACdJ,WAAW,GACXC,eAAe,GAPO,sBASsBU,gBAAgB,EATtC,CASdC,cATc,mBASdA,cATc,CASCC,gBATD,mBASCA,gBATD,CAUtB,GAAG7D,KAAK,CAACiC,GAAN,CAAU,CAAV,EAAarB,aAAb,CAA2B,GAA3B,IAAkC,CAArC,CAAuC,CACrC,GAAGsC,YAAY,IAAIU,cAAc,CAACrB,MAAf,CAAsB,CAAzC,CAA2C,CACzCmC,YAAY,CAACd,cAAc,CAAC,CAAD,CAAf,CAAZ,CACD,CACF,CAJD,IAIK,CACH,GAAIA,cAAc,CAACrB,MAAf,CAAsB,CAAtB,EAA2BqB,cAAc,CAAC,CAAD,CAAd,CAAkBkB,WAAlB,CAAgCvE,IAAI,CAACgB,OAApE,CAA4E,CAC1Ea,gBAAgB,CAACwB,cAAc,CAAC,CAAD,CAAd,CAAkBW,EAAnB,CAAhB,CACD,CACF,CAGF,CAED7E,SAAS,CAAC,UAAM,CACd,GAAIO,MAAM,CAACW,aAAP,CAAqB,SAArB,IAAoC,CAAxC,CAA2C,CACzC,GAAMoE,CAAAA,QAAQ,CAAGC,WAAW,CAAC,UAAM,CACjCF,YAAY,GACb,CAF2B,CAEzB7D,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACI,MAAL,GAAgB,GAA3B,EAAkC,EAFT,CAA5B,CAKA,MAAO,WAAM,CACX4D,aAAa,CAACF,QAAD,CAAb,CACD,CAFD,CAGD,CACF,CAXQ,CAWN,CAACtD,QAAD,CAAWzB,MAAX,CAAmBC,KAAnB,CAXM,CAAT,CAcA,mBACE,YACE,SAAS,CAAEa,SADb,CAEE,GAAG,CAAET,WAFP,CAGE,EAAE,CAAEN,KAAK,CAACiC,GAHZ,CAIE,KAAK,CAAE,CACLkD,YAAY,CAAE5E,IAAI,CAACgB,OAAL,CAAe,CADxB,CAEL6D,MAAM,CAAE7E,IAAI,CAACgB,OAFR,CAGL8D,KAAK,CAAE9E,IAAI,CAACgB,OAHP,CAIL+D,eAAe,CAAEzE,KAJZ,CAKLa,QAAQ,CAAE,UALL,CAML6D,GAAG,CAAE7D,QAAQ,CAACF,CANT,CAOLgE,IAAI,CAAE9D,QAAQ,CAACT,CAPV,CAQLwE,UAAU,CAAE,sBARP,CASLC,eAAe,CACb1F,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,CAAmC,kBAAnC,CAAwD,MAVrD,CAWLiF,SAAS,CACP3F,KAAK,CAACQ,KAAN,CAAc,KAAd,CAAsBC,IAAI,CAACC,GAAL,EAAtB,CAAmC,kBAAnC,CAAwD,MAZrD,CAJT,EADF,CAqBD,CA1PD,CA4PA,cAAeX,CAAAA,QAAf","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\n\r\n\r\n\r\n\r\n\r\nconst Creature = (props) => {\r\n  const { status, speed, calamities, resources ,totalPopulation} = useGlobalState();\r\n  const creatureRef = useRef(null);\r\n  const size = useRef(props.size ? props.size : 6);\r\n  const [color, setColor] = useState(\r\n    props.birth + 10000 > Date.now()\r\n      ? \"#44FFE3\"\r\n      : props.gender.localeCompare(\"M\") === 0\r\n      ? \"#E8FF95\"\r\n      : \"#FF4489\"\r\n  );\r\n  const [className, setClassName] = useState(\r\n    props.birth + 10000 > Date.now() ? \"babyCreature\" : \"adultCreature\"\r\n  );\r\n  const [position, setPosition] = useState({\r\n    x: props.x\r\n      ? props.x\r\n      : Math.floor((props.dim.w - 20) * Math.random() - size.current / 2 + 10),\r\n    y: props.y\r\n      ? props.y\r\n      : Math.floor((props.dim.h - 20) * Math.random() - size.current / 2 + 10),\r\n  });\r\n\r\n  function increaseSize() {\r\n    size.current = 10;\r\n  }\r\n\r\n  //destroy self\r\n  function selfDestroy() {\r\n    const event = new CustomEvent(\"death\", {\r\n      detail: { uid: props.uid },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  function destroyNeighbour(neighbourUID) {\r\n    const event = new CustomEvent(\"death\", {\r\n      detail: { uid: neighbourUID },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  //check if there is any calamity nearby\r\n  function checkCalamity() {\r\n    if (calamities.length > 0) {\r\n      for (var i = 0; i < calamities.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - calamities[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - calamities[i].position.y\r\n        );\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < calamities[i].size) {\r\n          selfDestroy();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //check if there is any water body nearby\r\n  function checkResources() {\r\n    if (resources.length > 0) {\r\n      for (var i = 0; i < resources.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - resources[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - resources[i].position.y\r\n        );\r\n\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < resources[i].size / 2 + 30) {\r\n          if (distance < resources[i].size / 2) {\r\n            //do something here asumming the creature becomes wwater animal\r\n          } else {\r\n            increaseSize();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function changeColor() {\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      color.localeCompare(\"#44FFE3\") === 0\r\n    )\r\n      setColor(props.gender.localeCompare(\"M\") === 0 ? \"#E8FF95\" : \"#FF4489\");\r\n  }\r\n\r\n  function changeClassName() {\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      className.localeCompare(\"babyCreature\") === 0\r\n    )\r\n      setClassName(\"adultCreature\");\r\n  }\r\n\r\n  function canReproduce() {\r\n    if (className.localeCompare(\"adultCreature\") === 0) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function checkIfOldEnoughToDie(){\r\n    if(Date.now()>props.birth+50000&&Math.random()>0.97){\r\n      selfDestroy();\r\n    }\r\n  }\r\n  //change position randomly *update to tendency based position change*\r\n  function changePosition() {\r\n    const pos = [1, -1];\r\n    const skipX = Math.floor(Math.random() * speed);\r\n    const skipY = Math.floor(Math.random() * speed);\r\n\r\n    const plusMinusX = Math.floor(Math.random() * 2);\r\n    const plusMinusY = Math.floor(Math.random() * 2);\r\n\r\n    const newPosition = {\r\n      x: position.x + pos[plusMinusX] * skipX,\r\n      y: position.y + pos[plusMinusY] * skipY,\r\n    };\r\n\r\n    if (newPosition.x + size.current + 10 > props.dim.w) {\r\n      newPosition.x = props.dim.w - size.current - 10;\r\n    }\r\n    if (newPosition.y + size.current + 10 > props.dim.h) {\r\n      newPosition.y = props.dim.h - size.current - 10;\r\n    }\r\n    if (newPosition.x < 10) {\r\n      newPosition.x = 10;\r\n    }\r\n    if (newPosition.y < 10) {\r\n      newPosition.y = 10;\r\n    }\r\n\r\n    setPosition(newPosition);\r\n  }\r\n\r\n  //get all neighbouring adults\r\n  function getNeighbourHood() {\r\n    \r\n    const maleNeighbours = [];\r\n    const femaleNeighbours = [];\r\n    if (creatureRef?.current) {\r\n      const children = creatureRef.current?.parentNode?.childNodes;\r\n      if (children) {\r\n        Object.keys(children).forEach((key) => {\r\n          if (\r\n            children[key]?.className.localeCompare(\"adultCreature\") === 0 &&\r\n            Math.abs(children[key].offsetLeft - position.x) < 10 &&\r\n            Math.abs(children[key].offsetTop - position.y) < 10 &&\r\n            children[key].id.localeCompare(props.uid) !== 0\r\n          ) {\r\n            if(children[key].id[0].localeCompare(\"F\")===0){\r\n              femaleNeighbours.push(children[key]);\r\n            }else{\r\n               maleNeighbours.push(children[key]);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    const neighbourHood = {maleNeighbours,femaleNeighbours};\r\n    return neighbourHood;\r\n  }\r\n\r\n  //send birth request to earth\r\n  function birthRequest(neighbour) {\r\n    const mother = { id: props.uid, position: position, size: size.current };\r\n    const father = {\r\n      id: neighbour.id,\r\n      position: {\r\n        x: neighbour.offsetLeft,\r\n        y: neighbour.offsetTop,\r\n      },\r\n      size: neighbour.clientWidth,\r\n    };\r\n\r\n    const event = new CustomEvent(\"birth\", {\r\n      detail: { mother, father },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  //regular activity function\r\n  function doActivities() {\r\n    checkIfOldEnoughToDie()\r\n    checkCalamity();\r\n    checkResources();\r\n\r\n    changePosition();\r\n    changeColor();\r\n    changeClassName();\r\n\r\n    const { maleNeighbours,femaleNeighbours } = getNeighbourHood();\r\n    if(props.uid[0].localeCompare(\"F\")===0){\r\n      if(canReproduce()&&maleNeighbours.length>0){\r\n        birthRequest(maleNeighbours[0]);\r\n      }\r\n    }else{\r\n      if (maleNeighbours.length>0 && maleNeighbours[0].clientWidth < size.current){\r\n        destroyNeighbour(maleNeighbours[0].id);\r\n      }\r\n    }\r\n\r\n    \r\n  }\r\n\r\n  useEffect(() => {\r\n    if (status.localeCompare(\"Playing\") === 0) {\r\n      const interval = setInterval(() => {\r\n        doActivities();\r\n      }, Math.floor(Math.random() * 500) + 10);\r\n\r\n      \r\n      return () => {\r\n        clearInterval(interval);\r\n      };\r\n    }\r\n  }, [position, status, speed]);\r\n\r\n  \r\n  return (\r\n    <div\r\n      className={className}\r\n      ref={creatureRef}\r\n      id={props.uid}\r\n      style={{\r\n        borderRadius: size.current / 2,\r\n        height: size.current,\r\n        width: size.current,\r\n        backgroundColor: color,\r\n        position: \"absolute\",\r\n        top: position.y,\r\n        left: position.x,\r\n        transition: \"all 0.5s ease-in-out\",\r\n        WebkitBoxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\",\r\n        boxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\",\r\n      }}\r\n    ></div>\r\n  );\r\n};\r\n\r\nexport default Creature;\r\n"]},"metadata":{},"sourceType":"module"}