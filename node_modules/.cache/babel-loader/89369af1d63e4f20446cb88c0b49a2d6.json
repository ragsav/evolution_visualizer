{"ast":null,"code":"import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from\"react\";import{Vector}from\"./vector\";import{useGlobalState,useGlobalActions}from\"../../context/globalContext\";import{Food}from\"./food\";import EarthQuake from\"../calamities/earthQuake\";import Volcano from\"../calamities/volcana\";import Radiation from\"../calamities/radiation\";import WaterBody from\"../resources/waterBody\";import{makeInitialFood,makeInitialPopulation}from\"../gaFunctions/initiators\";import{isPairEqual,randInt}from\"../utils/util\";import{matingPool}from\"../gaFunctions/mating\";import{findFood}from\"../gaFunctions/survival\";import{calamityEffect,handleCalamityEffect,plagueInfectionToNeighbours}from\"../gaFunctions/calamityEffect\";import ChartsModal from\"../statistics/charts\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function clearCanvas(ctx,canvasRef){var _canvasRef$current,_canvasRef$current2;ctx===null||ctx===void 0?void 0:ctx.clearRect(0,0,canvasRef===null||canvasRef===void 0?void 0:(_canvasRef$current=canvasRef.current)===null||_canvasRef$current===void 0?void 0:_canvasRef$current.clientWidth,canvasRef===null||canvasRef===void 0?void 0:(_canvasRef$current2=canvasRef.current)===null||_canvasRef$current2===void 0?void 0:_canvasRef$current2.clientHeight);}function addRandomNumberOfFood(foods,rate){if(Math.random()<rate){var food=new Food(randInt(10,window.innerWidth-300-10),randInt(10,window.innerHeight-10),foods);}}function die(creatures){for(var i=0;i<creatures.current.length;i++){if(creatures.current[i].canDie()){creatures.current.splice(i,1);}}}var Earth=function Earth(){var _useGlobalState=useGlobalState(),restarted=_useGlobalState.restarted,calamityType=_useGlobalState.calamityType,calamities=_useGlobalState.calamities,resources=_useGlobalState.resources,resourceType=_useGlobalState.resourceType,status=_useGlobalState.status,speed=_useGlobalState.speed,initialPopulation=_useGlobalState.initialPopulation,foodSpawnRate=_useGlobalState.foodSpawnRate,isChartModalVisible=_useGlobalState.isChartModalVisible;var _useGlobalActions=useGlobalActions(),setTotalPopulation=_useGlobalActions.setTotalPopulation,setCalamityPosition=_useGlobalActions.setCalamityPosition,setResourcePosition=_useGlobalActions.setResourcePosition,setIsChartModalVisible=_useGlobalActions.setIsChartModalVisible;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),ctx=_useState2[0],setCtx=_useState2[1];var canvasRef=useRef(null);var foodSpawnRateRef=useRef(foodSpawnRate);var speedRef=useRef(0.5);var statusRef=useRef(status);var calamitiesRef=useRef(calamities);var CREATURES=useRef([]);var FOODS=useRef([]);var data=useRef([]);useEffect(function(){foodSpawnRateRef.current=foodSpawnRate;},[foodSpawnRate]);useEffect(function(){speedRef.current=speed;},[speed]);useEffect(function(){calamitiesRef.current=calamities;},[calamities]);useEffect(function(){if(canvasRef&&canvasRef.current){var canvas=document.getElementById(\"canvas\");var _ctx=canvas.getContext(\"2d\");canvasRef.current.focus();setCtx(_ctx);}},[canvasRef]);useEffect(function(){if(ctx){clearCanvas(ctx,canvasRef);makeInitialPopulation(initialPopulation,CREATURES);makeInitialFood(FOODS);data.current=[];}},[ctx,restarted,initialPopulation]);useEffect(function(){var reqID=null;statusRef.current=status;if(status.localeCompare(\"Playing\")===0){reqID=requestAnimationFrame(mainLoop);}return function(){if(reqID){cancelAnimationFrame(reqID);}};},[status]);function mainLoop(timestamp){if(statusRef.current.localeCompare(\"Playing\")===0){data.current.push({timestamp:timestamp,population:CREATURES.current.length,food:FOODS.current.length});clearCanvas(ctx,canvasRef);calamityEffect(CREATURES,calamitiesRef);findFood(CREATURES,FOODS);die(CREATURES);plagueInfectionToNeighbours(CREATURES);matingPool(CREATURES);CREATURES.current.forEach(function(b,index){b.updateCreature(ctx,speedRef.current);});FOODS.current.forEach(function(f,index){f.drawFood(ctx);});addRandomNumberOfFood(FOODS,foodSpawnRateRef.current);setTotalPopulation(CREATURES.current.length);requestAnimationFrame(mainLoop);}return;}function handleCanvasClick(e){var mouse=new Vector(e.clientX-300,e.clientY);handleCalamityEffect(CREATURES,calamities,calamityType,mouse,setCalamityPosition);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(ChartsModal,{show:isChartModalVisible,data:data.current,onHide:function onHide(){setIsChartModalVisible(false);}}),resources?resources.map(function(resource){if(resource.type.localeCompare(\"waterBody\")===0){return/*#__PURE__*/_jsx(WaterBody,{uid:resource.id,size:resource.size,position:resource.position},\"\".concat(resource.id,\"+resource\"));}}):null,calamities?calamities.map(function(calamity){if(calamity.type.localeCompare(\"earthQuake\")===0){return/*#__PURE__*/_jsx(EarthQuake,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}else if(calamity.type.localeCompare(\"volcano\")===0){return/*#__PURE__*/_jsx(Volcano,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}else if(calamity.type.localeCompare(\"radiation\")===0){return/*#__PURE__*/_jsx(Radiation,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}}):null,/*#__PURE__*/_jsx(\"canvas\",{onClick:handleCanvasClick,tabIndex:1,id:\"canvas\",ref:canvasRef,width:window.innerWidth-300,height:window.innerHeight,style:{backgroundColor:\"#222222\"}})]});};export default Earth;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/core/earth.js"],"names":["useEffect","useRef","useState","Vector","useGlobalState","useGlobalActions","Food","EarthQuake","Volcano","Radiation","WaterBody","makeInitialFood","makeInitialPopulation","isPairEqual","randInt","matingPool","findFood","calamityEffect","handleCalamityEffect","plagueInfectionToNeighbours","ChartsModal","clearCanvas","ctx","canvasRef","clearRect","current","clientWidth","clientHeight","addRandomNumberOfFood","foods","rate","Math","random","food","window","innerWidth","innerHeight","die","creatures","i","length","canDie","splice","Earth","restarted","calamityType","calamities","resources","resourceType","status","speed","initialPopulation","foodSpawnRate","isChartModalVisible","setTotalPopulation","setCalamityPosition","setResourcePosition","setIsChartModalVisible","setCtx","foodSpawnRateRef","speedRef","statusRef","calamitiesRef","CREATURES","FOODS","data","canvas","document","getElementById","getContext","focus","reqID","localeCompare","requestAnimationFrame","mainLoop","cancelAnimationFrame","timestamp","push","population","forEach","b","index","updateCreature","f","drawFood","handleCanvasClick","e","mouse","clientX","clientY","map","resource","type","id","size","position","calamity","amplitude","duration","backgroundColor"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport { Vector } from \"./vector\";\r\nimport { useGlobalState, useGlobalActions } from \"../../context/globalContext\";\r\nimport { Food } from \"./food\";\r\nimport EarthQuake from \"../calamities/earthQuake\";\r\nimport Volcano from \"../calamities/volcana\";\r\nimport Radiation from \"../calamities/radiation\";\r\nimport WaterBody from \"../resources/waterBody\";\r\nimport {\r\n  makeInitialFood,\r\n  makeInitialPopulation,\r\n} from \"../gaFunctions/initiators\";\r\nimport { isPairEqual, randInt } from \"../utils/util\";\r\nimport { matingPool } from \"../gaFunctions/mating\";\r\nimport { findFood } from \"../gaFunctions/survival\";\r\nimport {\r\n  calamityEffect,\r\n  handleCalamityEffect,\r\n  plagueInfectionToNeighbours,\r\n} from \"../gaFunctions/calamityEffect\";\r\n\r\nimport ChartsModal from \"../statistics/charts\";\r\n\r\nfunction clearCanvas(ctx, canvasRef) {\r\n  ctx?.clearRect(\r\n    0,\r\n    0,\r\n    canvasRef?.current?.clientWidth,\r\n    canvasRef?.current?.clientHeight\r\n  );\r\n}\r\n\r\nfunction addRandomNumberOfFood(foods, rate) {\r\n  if (Math.random() < rate) {\r\n    const food = new Food(\r\n      randInt(10, window.innerWidth - 300 - 10),\r\n      randInt(10, window.innerHeight - 10),\r\n      foods\r\n    );\r\n  }\r\n}\r\n\r\nfunction die(creatures) {\r\n  for (let i = 0; i < creatures.current.length; i++) {\r\n    if (creatures.current[i].canDie()) {\r\n      creatures.current.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nconst Earth = () => {\r\n  const {\r\n    restarted,\r\n    calamityType,\r\n    calamities,\r\n    resources,\r\n    resourceType,\r\n    status,\r\n    speed,\r\n    initialPopulation,\r\n    foodSpawnRate,\r\n    isChartModalVisible,\r\n  } = useGlobalState();\r\n\r\n  const {\r\n    setTotalPopulation,\r\n    setCalamityPosition,\r\n    setResourcePosition,\r\n    setIsChartModalVisible,\r\n  } = useGlobalActions();\r\n\r\n  const [ctx, setCtx] = useState(null);\r\n\r\n  const canvasRef = useRef(null);\r\n  const foodSpawnRateRef = useRef(foodSpawnRate);\r\n  const speedRef = useRef(0.5);\r\n  const statusRef = useRef(status);\r\n  const calamitiesRef = useRef(calamities);\r\n  const CREATURES = useRef([]);\r\n  const FOODS = useRef([]);\r\n  const data = useRef([]);\r\n\r\n  useEffect(() => {\r\n    foodSpawnRateRef.current = foodSpawnRate;\r\n  }, [foodSpawnRate]);\r\n  useEffect(() => {\r\n    speedRef.current = speed;\r\n  }, [speed]);\r\n\r\n  useEffect(() => {\r\n    calamitiesRef.current = calamities;\r\n  }, [calamities]);\r\n\r\n  useEffect(() => {\r\n    if (canvasRef && canvasRef.current) {\r\n      const canvas = document.getElementById(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n      canvasRef.current.focus();\r\n      setCtx(ctx);\r\n    }\r\n  }, [canvasRef]);\r\n\r\n  useEffect(() => {\r\n    if (ctx) {\r\n      clearCanvas(ctx, canvasRef);\r\n      makeInitialPopulation(initialPopulation, CREATURES);\r\n      makeInitialFood(FOODS);\r\n      data.current = [];\r\n    }\r\n  }, [ctx, restarted, initialPopulation]);\r\n\r\n  useEffect(() => {\r\n    let reqID = null;\r\n    statusRef.current = status;\r\n    if (status.localeCompare(\"Playing\") === 0) {\r\n      reqID = requestAnimationFrame(mainLoop);\r\n    }\r\n    return () => {\r\n      if (reqID) {\r\n        cancelAnimationFrame(reqID);\r\n      }\r\n    };\r\n  }, [status]);\r\n\r\n  function mainLoop(timestamp) {\r\n    if (statusRef.current.localeCompare(\"Playing\") === 0) {\r\n      data.current.push({\r\n        timestamp,\r\n        population: CREATURES.current.length,\r\n        food: FOODS.current.length,\r\n      });\r\n      clearCanvas(ctx, canvasRef);\r\n      calamityEffect(CREATURES, calamitiesRef);\r\n      findFood(CREATURES, FOODS);\r\n      die(CREATURES);\r\n      plagueInfectionToNeighbours(CREATURES);\r\n      matingPool(CREATURES);\r\n      CREATURES.current.forEach((b, index) => {\r\n        b.updateCreature(ctx, speedRef.current);\r\n      });\r\n      FOODS.current.forEach((f, index) => {\r\n        f.drawFood(ctx);\r\n      });\r\n      addRandomNumberOfFood(FOODS, foodSpawnRateRef.current);\r\n      setTotalPopulation(CREATURES.current.length);\r\n      requestAnimationFrame(mainLoop);\r\n    }\r\n    return;\r\n  }\r\n\r\n  function handleCanvasClick(e) {\r\n    const mouse = new Vector(e.clientX - 300, e.clientY);\r\n    handleCalamityEffect(\r\n      CREATURES,\r\n      calamities,\r\n      calamityType,\r\n      mouse,\r\n      setCalamityPosition\r\n    );\r\n  }\r\n  return (\r\n    <div>\r\n      <ChartsModal\r\n        show={isChartModalVisible}\r\n        data={data.current}\r\n        onHide={() => {\r\n          setIsChartModalVisible(false);\r\n        }}\r\n      />\r\n      {resources\r\n        ? resources.map((resource) => {\r\n            if (resource.type.localeCompare(\"waterBody\") === 0) {\r\n              return (\r\n                <WaterBody\r\n                  key={`${resource.id}+resource`}\r\n                  uid={resource.id}\r\n                  size={resource.size}\r\n                  position={resource.position}\r\n                ></WaterBody>\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      {calamities\r\n        ? calamities.map((calamity) => {\r\n            if (calamity.type.localeCompare(\"earthQuake\") === 0) {\r\n              return (\r\n                <EarthQuake\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"volcano\") === 0) {\r\n              return (\r\n                <Volcano\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"radiation\") === 0) {\r\n              return (\r\n                <Radiation\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      <canvas\r\n        onClick={handleCanvasClick}\r\n        tabIndex={1}\r\n        id=\"canvas\"\r\n        ref={canvasRef}\r\n        width={window.innerWidth - 300}\r\n        height={window.innerHeight}\r\n        style={{ backgroundColor: \"#222222\" }}\r\n      ></canvas>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}