{"ast":null,"code":"import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createRef,useEffect,useRef,useState}from\"react\";import{useGlobalActions,useGlobalState}from\"../context/globalContext\";import{jsx as _jsx}from\"react/jsx-runtime\";var Creature=function Creature(props){var _useGlobalState=useGlobalState(),status=_useGlobalState.status,speed=_useGlobalState.speed,calamities=_useGlobalState.calamities,resources=_useGlobalState.resources;var creatureRef=useRef(null);var size=useRef(props.size?props.size:6);var _useState=useState(props.birth+10000>Date.now()?\"#FF4489\":\"#E8FF95\"),_useState2=_slicedToArray(_useState,2),color=_useState2[0],setColor=_useState2[1];var _useState3=useState(props.birth+10000>Date.now()?\"babyCreature\":\"adultCreature\"),_useState4=_slicedToArray(_useState3,2),className=_useState4[0],setClassName=_useState4[1];var _useState5=useState({x:props.x?props.x:Math.floor((props.dim.w-20)*Math.random()-size.current/2+10),y:props.y?props.y:Math.floor((props.dim.h-20)*Math.random()-size.current/2+10)}),_useState6=_slicedToArray(_useState5,2),position=_useState6[0],setPosition=_useState6[1];function increaseSize(){size.current=10;}//destroy self\nfunction selfDestroy(){var _props$earthRef,_props$earthRef$curre;var event=new CustomEvent(\"death\",{detail:{uid:props.uid}});(_props$earthRef=props.earthRef)===null||_props$earthRef===void 0?void 0:(_props$earthRef$curre=_props$earthRef.current)===null||_props$earthRef$curre===void 0?void 0:_props$earthRef$curre.dispatchEvent(event);}//check if there is any calamity nearby\nfunction checkCalamity(){if(calamities.length>0){for(var i=0;i<calamities.length;i++){var xDiff=Math.abs(position.x+size.current/2-calamities[i].position.x);var yDiff=Math.abs(position.y+size.current/2-calamities[i].position.y);var distance=Math.sqrt(Math.pow(xDiff,2)+Math.pow(yDiff,2));if(distance<calamities[i].size){selfDestroy();}}}}//check if there is any water body nearby\nfunction checkResources(){if(resources.length>0){for(var i=0;i<resources.length;i++){var xDiff=Math.abs(position.x+size.current/2-resources[i].position.x);var yDiff=Math.abs(position.y+size.current/2-resources[i].position.y);var distance=Math.sqrt(Math.pow(xDiff,2)+Math.pow(yDiff,2));if(distance<resources[i].size/2+30){if(distance<resources[i].size/2){//do something here asumming the creature becomes wwater animal\n}else{increaseSize();}}}}}function changeColor(){if(props.birth+10000<Date.now()&&color.localeCompare(\"#FF4489\")===0)setColor(\"#E8FF95\");}function changeClassName(){if(props.birth+10000<Date.now()&&className.localeCompare(\"babyCreature\")===0)setClassName(\"adultCreature\");}function canReproduce(){if(className.localeCompare(\"adultCreature\")===0){return true;}else{return false;}}//change position randomly *update to tendency based position change*\nfunction changePosition(){var pos=[1,-1];var skipX=Math.floor(Math.random()*speed);var skipY=Math.floor(Math.random()*speed);var plusMinusX=Math.floor(Math.random()*2);var plusMinusY=Math.floor(Math.random()*2);var newPosition={x:position.x+pos[plusMinusX]*skipX,y:position.y+pos[plusMinusY]*skipY};if(newPosition.x+size.current+10>props.dim.w){newPosition.x=props.dim.w-size.current-10;}if(newPosition.y+size.current+10>props.dim.h){newPosition.y=props.dim.h-size.current-10;}if(newPosition.x<10){newPosition.x=10;}if(newPosition.y<10){newPosition.y=10;}setPosition(newPosition);}//get all neighbouring adults\nfunction getNeighbourHood(){var neighbourHood={};var neighbours=[];if(creatureRef===null||creatureRef===void 0?void 0:creatureRef.current){var _creatureRef$current,_creatureRef$current$;var children=(_creatureRef$current=creatureRef.current)===null||_creatureRef$current===void 0?void 0:(_creatureRef$current$=_creatureRef$current.parentNode)===null||_creatureRef$current$===void 0?void 0:_creatureRef$current$.childNodes;if(children){Object.keys(children).forEach(function(key){var _children$key;if(((_children$key=children[key])===null||_children$key===void 0?void 0:_children$key.className.localeCompare(\"adultCreature\"))===0&&Math.abs(children[key].offsetLeft-position.x)<10&&Math.abs(children[key].offsetTop-position.y)<10&&children[key].id.localeCompare(props.uid)!==0){neighbours.push(children[key]);}});}}neighbourHood.neighbours=neighbours;return neighbourHood;}//send birth request to earth\nfunction birthRequest(neighbour){var _props$earthRef2,_props$earthRef2$curr;var mother={id:props.uid,position:position,size:size.current};var father={id:neighbour.id,position:{x:neighbour.offsetLeft,y:neighbour.offsetTop},size:neighbour.clientWidth};var event=new CustomEvent(\"birth\",{detail:{mother:mother,father:father}});(_props$earthRef2=props.earthRef)===null||_props$earthRef2===void 0?void 0:(_props$earthRef2$curr=_props$earthRef2.current)===null||_props$earthRef2$curr===void 0?void 0:_props$earthRef2$curr.dispatchEvent(event);}//regular activity function\nfunction doActivities(){checkCalamity();checkResources();changePosition();changeColor();changeClassName();var _getNeighbourHood=getNeighbourHood(),neighbours=_getNeighbourHood.neighbours;if(canReproduce()&&neighbours.length>0){birthRequest(neighbours[0]);}}useEffect(function(){if(status.localeCompare(\"Playing\")===0){var interval=setInterval(function(){doActivities();},Math.floor(Math.random()*500)+10);return function(){clearInterval(interval);};}},[position,status,speed]);return/*#__PURE__*/_jsx(\"div\",{className:className,ref:creatureRef,id:props.uid,style:{borderRadius:size.current/2,height:size.current,width:size.current,backgroundColor:color,position:\"absolute\",top:position.y,left:position.x,transition:\"all 0.5s ease-in-out\",WebkitBoxShadow:props.birth+10000>Date.now()?\"0 0 10px #FF4489\":\"none\",boxShadow:props.birth+10000>Date.now()?\"0 0 10px #FF4489\":\"none\"}});};export default Creature;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/creature.js"],"names":["createRef","useEffect","useRef","useState","useGlobalActions","useGlobalState","Creature","props","status","speed","calamities","resources","creatureRef","size","birth","Date","now","color","setColor","className","setClassName","x","Math","floor","dim","w","random","current","y","h","position","setPosition","increaseSize","selfDestroy","event","CustomEvent","detail","uid","earthRef","dispatchEvent","checkCalamity","length","i","xDiff","abs","yDiff","distance","sqrt","pow","checkResources","changeColor","localeCompare","changeClassName","canReproduce","changePosition","pos","skipX","skipY","plusMinusX","plusMinusY","newPosition","getNeighbourHood","neighbourHood","neighbours","children","parentNode","childNodes","Object","keys","forEach","key","offsetLeft","offsetTop","id","push","birthRequest","neighbour","mother","father","clientWidth","doActivities","interval","setInterval","clearInterval","borderRadius","height","width","backgroundColor","top","left","transition","WebkitBoxShadow","boxShadow"],"mappings":"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","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\n\r\n\r\n\r\n\r\n\r\nconst Creature = (props) => {\r\n  const { status, speed, calamities, resources } = useGlobalState();\r\n  const creatureRef = useRef(null);\r\n  const size = useRef(props.size ? props.size : 6);\r\n  const [color, setColor] = useState(\r\n    props.birth + 10000 > Date.now() ? \"#FF4489\" : \"#E8FF95\"\r\n  );\r\n  const [className, setClassName] = useState(\r\n    props.birth + 10000 > Date.now() ? \"babyCreature\" : \"adultCreature\"\r\n  );\r\n  const [position, setPosition] = useState({\r\n    x: props.x\r\n      ? props.x\r\n      : Math.floor((props.dim.w - 20) * Math.random() - size.current / 2 + 10),\r\n    y: props.y\r\n      ? props.y\r\n      : Math.floor((props.dim.h - 20) * Math.random() - size.current / 2 + 10),\r\n  });\r\n\r\n\r\n  function increaseSize() {\r\n    size.current = 10;\r\n  }\r\n\r\n  //destroy self\r\n  function selfDestroy() {\r\n    const event = new CustomEvent(\"death\", {\r\n      detail: { uid: props.uid },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n\r\n  //check if there is any calamity nearby\r\n  function checkCalamity() {\r\n    if (calamities.length > 0) {\r\n      for (var i = 0; i < calamities.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - calamities[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - calamities[i].position.y\r\n        );\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < calamities[i].size) {\r\n          selfDestroy();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  //check if there is any water body nearby\r\n  function checkResources() {\r\n    if (resources.length > 0) {\r\n      for (var i = 0; i < resources.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - resources[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - resources[i].position.y\r\n        );\r\n\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < resources[i].size / 2 + 30) {\r\n          if (distance < resources[i].size / 2) {\r\n            //do something here asumming the creature becomes wwater animal\r\n          } else {\r\n            increaseSize();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  function changeColor(){\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      color.localeCompare(\"#FF4489\") === 0\r\n    )\r\n      setColor(\"#E8FF95\");\r\n  }\r\n  \r\n  function changeClassName(){\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      className.localeCompare(\"babyCreature\") === 0\r\n    )\r\n      setClassName(\"adultCreature\");\r\n  }\r\n  \r\n  function canReproduce() {\r\n    if (className.localeCompare(\"adultCreature\") === 0) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n\r\n  //change position randomly *update to tendency based position change*\r\n  function changePosition() {\r\n    const pos = [1, -1];\r\n    const skipX = Math.floor(Math.random() * speed);\r\n    const skipY = Math.floor(Math.random() * speed);\r\n\r\n    const plusMinusX = Math.floor(Math.random() * 2);\r\n    const plusMinusY = Math.floor(Math.random() * 2);\r\n\r\n    const newPosition = {\r\n      x: position.x + pos[plusMinusX] * skipX,\r\n      y: position.y + pos[plusMinusY] * skipY,\r\n    };\r\n\r\n    if (newPosition.x + size.current + 10 > props.dim.w) {\r\n      newPosition.x = props.dim.w - size.current - 10;\r\n    }\r\n    if (newPosition.y + size.current + 10 > props.dim.h) {\r\n      newPosition.y = props.dim.h - size.current - 10;\r\n    }\r\n    if (newPosition.x < 10) {\r\n      newPosition.x = 10;\r\n    }\r\n    if (newPosition.y < 10) {\r\n      newPosition.y = 10;\r\n    }\r\n\r\n    setPosition(newPosition);\r\n  }\r\n\r\n\r\n\r\n  //get all neighbouring adults\r\n  function getNeighbourHood() {\r\n    const neighbourHood = {};\r\n    const neighbours = [];\r\n    if (creatureRef?.current) {\r\n      const children = creatureRef.current?.parentNode?.childNodes;\r\n      if (children) {\r\n        Object.keys(children).forEach((key) => {\r\n          if (\r\n            children[key]?.className.localeCompare(\"adultCreature\") === 0 &&\r\n            Math.abs(children[key].offsetLeft - position.x) < 10 &&\r\n            Math.abs(children[key].offsetTop - position.y) < 10 &&\r\n            children[key].id.localeCompare(props.uid) !== 0\r\n          ) {\r\n            neighbours.push(children[key]);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    neighbourHood.neighbours = neighbours;\r\n    return neighbourHood;\r\n  }\r\n\r\n  //send birth request to earth\r\n  function birthRequest(neighbour) {\r\n    const mother = { id: props.uid, position: position, size: size.current };\r\n    const father = {\r\n      id: neighbour.id,\r\n      position: {\r\n        x: neighbour.offsetLeft,\r\n        y: neighbour.offsetTop,\r\n      },\r\n      size: neighbour.clientWidth,\r\n    };\r\n\r\n    \r\n    const event = new CustomEvent(\"birth\", {\r\n      detail: { mother, father },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  //regular activity function\r\n  function doActivities(){\r\n    checkCalamity();\r\n    checkResources();\r\n    \r\n    changePosition();\r\n    changeColor();\r\n    changeClassName();\r\n    \r\n    const { neighbours } = getNeighbourHood();\r\n\r\n    if (\r\n      canReproduce() &&\r\n      neighbours.length > 0\r\n    ) {\r\n      birthRequest(neighbours[0]);\r\n    }\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    if (status.localeCompare(\"Playing\") === 0) {\r\n      const interval = setInterval(() => {\r\n        doActivities();\r\n      }, Math.floor(Math.random() * 500) + 10);\r\n      return () => {\r\n        clearInterval(interval);\r\n      };\r\n    }\r\n  }, [position, status, speed]);\r\n\r\n\r\n  return (\r\n    <div\r\n      className={className}\r\n      ref={creatureRef}\r\n      id={props.uid}\r\n      style={{\r\n        borderRadius: size.current / 2,\r\n        height: size.current,\r\n        width: size.current,\r\n        backgroundColor: color,\r\n        position: \"absolute\",\r\n        top: position.y,\r\n        left: position.x,\r\n        transition: \"all 0.5s ease-in-out\",\r\n        WebkitBoxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #FF4489\" : \"none\",\r\n        boxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #FF4489\" : \"none\",\r\n      }}\r\n    ></div>\r\n  );\r\n};\r\n\r\nexport default Creature;\r\n"]},"metadata":{},"sourceType":"module"}