{"ast":null,"code":"import _toConsumableArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createRef,useEffect,useRef,useState}from\"react\";import{Card}from\"react-bootstrap\";import{v4 as uuidv4}from\"uuid\";import Creature from\"./creature\";import IconButton from\"@material-ui/core/IconButton\";import DehazeIcon from\"@material-ui/icons/Dehaze\";import{useGlobalActions,useGlobalState}from\"../context/globalContext\";import Statisitcs from\"./statistics\";import EarthQuake from\"./earthQuake\";import Volcano from\"./volcana\";import Radiation from\"./radiation\";import WaterBody from\"./waterBody\";// const demo = Array.from(Array(100).keys());\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var isPairEqual=function isPairEqual(a1,b1,a2,b2){// console.log(a1,b1,a2,b2);\nif((a1.localeCompare(a2)===0||a1.localeCompare(b2)===0)&&(b1.localeCompare(a2)===0||b1.localeCompare(b2)===0)){return true;}return false;};var Earth=function Earth(){var _useGlobalState=useGlobalState(),restarted=_useGlobalState.restarted,calamityType=_useGlobalState.calamityType,calamities=_useGlobalState.calamities,resources=_useGlobalState.resources,resourceType=_useGlobalState.resourceType,initialPopulation=_useGlobalState.initialPopulation;var _useGlobalActions=useGlobalActions(),setCalamityPosition=_useGlobalActions.setCalamityPosition,setResourcePosition=_useGlobalActions.setResourcePosition,setTotalPopulation=_useGlobalActions.setTotalPopulation;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),creatures=_useState2[0],setCreatures=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),contextMenuPosition=_useState4[0],setContextMenuPosition=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),earthDimensions=_useState6[0],setEarthDimensions=_useState6[1];var earthRef=/*#__PURE__*/createRef();var creaturesRef=useRef([]);var birthCache=useRef([]);//initial population of creatures\nfunction InitializeCreatures(initialPopulation){creaturesRef.current=[];for(var i=0;i<initialPopulation;i++){addNewCreature();}}//add new creature to creaturesRef\nfunction addNewCreature(props){var creaturesTemp=creaturesRef.current;var gender=Math.random()>0.5?\"M\":\"F\";var uid=\"\".concat(gender,\"-\").concat(uuidv4());creaturesTemp.push({uid:uid,birth:Date.now(),x:props===null||props===void 0?void 0:props.x,y:props===null||props===void 0?void 0:props.y,size:props===null||props===void 0?void 0:props.size,gender:gender});setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;return uid;}//remove creature by id from creatureRef\nfunction removeCreatureByUid(uid){var creaturesTemp=creaturesRef.current;for(var i=0;i<creaturesTemp.length;i++){if(creaturesTemp[i].uid.localeCompare(uid)===0){creaturesTemp.splice(i,1);setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;break;}}}//remove random creature\nfunction removeRandom(){var creaturesTemp=creaturesRef.current;creaturesTemp.splice(Math.floor(Math.random()*creaturesRef.current.length),1);setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;}//handle new births wheather the parents have mate recently or not\nfunction newBirth(_ref){var mother=_ref.mother,father=_ref.father;var birthCacheTemp=birthCache.current;var l=birthCacheTemp.length;var canGiveBirth=true;for(var i=0;i<l;i++){if(isPairEqual(birthCacheTemp[i].mother.id,birthCacheTemp[i].father.id,mother.id,father.id)){console.log(\"birth not allowed!\");canGiveBirth=false;break;}}if(canGiveBirth){var childId=addNewCreature({x:(mother.position.x+father.position.x)/2,y:(mother.position.y+father.position.y)/2,size:(mother.size+father.size)/2});birthCacheTemp.push({mother:mother,father:father});}if(birthCacheTemp.length>100){birthCacheTemp.shift();}birthCache.current=birthCacheTemp;}//handle left click\nfunction handleLeftClick(e){e.preventDefault();if(e.button===0){if(calamityType.localeCompare(\"none\")!==0&&calamities.length<5&&resourceType.localeCompare(\"none\")===0){setCalamityPosition({x:e.clientX-earthDimensions.left,y:e.clientY-earthDimensions.top});}else if(resourceType.localeCompare(\"none\")!==0&&resources.length<5&&calamityType.localeCompare(\"none\")===0){setResourcePosition({x:e.clientX-earthDimensions.left,y:e.clientY-earthDimensions.top});}}else if(e.button===2){handleRightClick(e);}}//handle right click\nfunction handleRightClick(e){e.preventDefault();setContextMenuPosition({x:e.clientX-earthDimensions.left,y:e.clientY-earthDimensions.top});}//set dimensions of earth when reference is available\nuseEffect(function(){if(earthRef&&earthRef.current&&!earthDimensions){setEarthDimensions({top:earthRef.current.offsetTop,left:earthRef.current.offsetLeft,w:earthRef.current.offsetWidth,h:earthRef.current.offsetHeight});console.log(earthDimensions);}},[earthRef]);//adding contectmenu listener to hide contect menu on right click\nuseEffect(function(){if(earthRef&&earthRef.current){earthRef.current.addEventListener(\"contextmenu\",function(e){e.preventDefault();});return function(){var _earthRef$current;earthRef===null||earthRef===void 0?void 0:(_earthRef$current=earthRef.current)===null||_earthRef$current===void 0?void 0:_earthRef$current.removeEventListener(\"contextmenu\",handleRightClick);};}},[earthRef]);//restart effect\nuseEffect(function(){if(restarted){InitializeCreatures(initialPopulation);}},[restarted,initialPopulation]);//add birth and death event handlers when earth reference is available\nuseEffect(function(){if(earthRef&&earthRef.current&&!earthDimensions){var birthHandler=function birthHandler(e){if(e.detail){newBirth({mother:e.detail.mother,father:e.detail.father});}};var deathHandler=function deathHandler(e){if(e.detail){removeCreatureByUid(e.detail.uid);}};earthRef.current.addEventListener(\"birth\",birthHandler);earthRef.current.addEventListener(\"death\",deathHandler);return function(){var _earthRef$current2,_earthRef$current3;earthRef===null||earthRef===void 0?void 0:(_earthRef$current2=earthRef.current)===null||_earthRef$current2===void 0?void 0:_earthRef$current2.removeEventListener(\"birth\",birthHandler);earthRef===null||earthRef===void 0?void 0:(_earthRef$current3=earthRef.current)===null||_earthRef$current3===void 0?void 0:_earthRef$current3.removeEventListener(\"death\",deathHandler);};}},[earthRef,earthRef.current]);//save population size in global state\nuseEffect(function(){setTotalPopulation(creatures.length);},[creatures]);return/*#__PURE__*/_jsxs(\"div\",{id:\"earth\",ref:earthRef,style:{backgroundColor:\"#2A2A2A\",height:\"100%\",width:window.innerWidth-300,overflow:\"hidden\",position:\"relative\"},onMouseDown:handleLeftClick,children:[resources?resources.map(function(resource){if(resource.type.localeCompare(\"waterBody\")===0){return/*#__PURE__*/_jsx(WaterBody,{uid:resource.id,size:resource.size,position:resource.position},\"\".concat(resource.id,\"+resource\"));}}):null,calamities?calamities.map(function(calamity){if(calamity.type.localeCompare(\"earthQuake\")===0){return/*#__PURE__*/_jsx(EarthQuake,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}else if(calamity.type.localeCompare(\"volcano\")===0){return/*#__PURE__*/_jsx(Volcano,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}else if(calamity.type.localeCompare(\"radiation\")===0){return/*#__PURE__*/_jsx(Radiation,{size:calamity.size,amplitude:calamity.amplitude,duration:calamity.duration,position:calamity.position},\"\".concat(calamity.id,\"+calamity\"));}}):null,earthRef&&earthDimensions?creatures.map(function(creature){return/*#__PURE__*/_jsx(Creature,{birth:creature.birth,uid:creature.uid,earthRef:earthRef,dim:earthDimensions,x:creature.x,y:creature.y,size:creature.size,gender:creature.gender},creature.uid);}):null]});};export default Earth;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/screen.js"],"names":["createRef","useEffect","useRef","useState","Card","v4","uuidv4","Creature","IconButton","DehazeIcon","useGlobalActions","useGlobalState","Statisitcs","EarthQuake","Volcano","Radiation","WaterBody","isPairEqual","a1","b1","a2","b2","localeCompare","Earth","restarted","calamityType","calamities","resources","resourceType","initialPopulation","setCalamityPosition","setResourcePosition","setTotalPopulation","creatures","setCreatures","contextMenuPosition","setContextMenuPosition","earthDimensions","setEarthDimensions","earthRef","creaturesRef","birthCache","InitializeCreatures","current","i","addNewCreature","props","creaturesTemp","gender","Math","random","uid","push","birth","Date","now","x","y","size","removeCreatureByUid","length","splice","removeRandom","floor","newBirth","mother","father","birthCacheTemp","l","canGiveBirth","id","console","log","childId","position","shift","handleLeftClick","e","preventDefault","button","clientX","left","clientY","top","handleRightClick","offsetTop","offsetLeft","w","offsetWidth","h","offsetHeight","addEventListener","removeEventListener","birthHandler","detail","deathHandler","backgroundColor","height","width","window","innerWidth","overflow","map","resource","type","calamity","amplitude","duration","creature"],"mappings":"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","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { Card } from \"react-bootstrap\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport Creature from \"./creature\";\r\n\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport DehazeIcon from \"@material-ui/icons/Dehaze\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\nimport Statisitcs from \"./statistics\";\r\nimport EarthQuake from \"./earthQuake\";\r\nimport Volcano from \"./volcana\";\r\nimport Radiation from \"./radiation\";\r\nimport WaterBody from \"./waterBody\";\r\n\r\n// const demo = Array.from(Array(100).keys());\r\n\r\n\r\n\r\n\r\n\r\nconst isPairEqual = (a1, b1, a2, b2) => {\r\n  // console.log(a1,b1,a2,b2);\r\n  if (\r\n    (a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) &&\r\n    (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nconst Earth = () => {\r\n  const {\r\n    restarted,\r\n    calamityType,\r\n    calamities,\r\n    resources,\r\n    resourceType,\r\n    initialPopulation,\r\n  } = useGlobalState();\r\n  const { setCalamityPosition, setResourcePosition,setTotalPopulation } = useGlobalActions();\r\n  const [creatures, setCreatures] = useState([]);\r\n  const [contextMenuPosition, setContextMenuPosition] = useState(null);\r\n  const [earthDimensions, setEarthDimensions] = useState(null);\r\n  const earthRef = createRef();\r\n  const creaturesRef = useRef([]);\r\n  const birthCache = useRef([]);\r\n\r\n  //initial population of creatures\r\n  function InitializeCreatures(initialPopulation) {\r\n    creaturesRef.current = [];\r\n    for (var i = 0; i < initialPopulation; i++) {\r\n      addNewCreature();\r\n    }\r\n  }\r\n\r\n  //add new creature to creaturesRef\r\n  function addNewCreature(props) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    const gender = Math.random()>0.5?\"M\":\"F\";\r\n    const uid = `${gender}-${uuidv4()}`;\r\n    creaturesTemp.push({\r\n      uid: uid,\r\n      birth: Date.now(),\r\n      x: props?.x,\r\n      y: props?.y,\r\n      size: props?.size,\r\n      gender:gender\r\n    });\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n    return uid;\r\n  }\r\n\r\n  //remove creature by id from creatureRef\r\n  function removeCreatureByUid(uid) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    for (var i = 0; i < creaturesTemp.length; i++) {\r\n      if (creaturesTemp[i].uid.localeCompare(uid) === 0) {\r\n        creaturesTemp.splice(i, 1);\r\n        setCreatures([...creaturesTemp]);\r\n        creaturesRef.current = creaturesTemp;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  //remove random creature\r\n  function removeRandom() {\r\n    const creaturesTemp = creaturesRef.current;\r\n    creaturesTemp.splice(\r\n      Math.floor(Math.random() * creaturesRef.current.length),\r\n      1\r\n    );\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n  }\r\n\r\n  //handle new births wheather the parents have mate recently or not\r\n  function newBirth({ mother, father }) {\r\n    const birthCacheTemp = birthCache.current;\r\n    const l = birthCacheTemp.length;\r\n\r\n    var canGiveBirth = true;\r\n    for (var i = 0; i < l; i++) {\r\n      if (\r\n        isPairEqual(\r\n          birthCacheTemp[i].mother.id,\r\n          birthCacheTemp[i].father.id,\r\n          mother.id,\r\n          father.id\r\n        )\r\n      ) {\r\n        console.log(\"birth not allowed!\");\r\n        canGiveBirth = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (canGiveBirth) {\r\n      const childId = addNewCreature({\r\n        x: (mother.position.x + father.position.x) / 2,\r\n        y: (mother.position.y + father.position.y) / 2,\r\n        size: (mother.size + father.size) / 2,\r\n      });\r\n      birthCacheTemp.push({ mother, father });\r\n    }\r\n    if (birthCacheTemp.length > 100) {\r\n      birthCacheTemp.shift();\r\n    }\r\n    birthCache.current = birthCacheTemp;\r\n  }\r\n\r\n  //handle left click\r\n  function handleLeftClick(e) {\r\n    e.preventDefault();\r\n    if (e.button === 0) {\r\n      if (\r\n        calamityType.localeCompare(\"none\") !== 0 &&\r\n        calamities.length < 5 &&\r\n        resourceType.localeCompare(\"none\") === 0\r\n      ) {\r\n        setCalamityPosition({\r\n          x: e.clientX - earthDimensions.left,\r\n          y: e.clientY - earthDimensions.top,\r\n        });\r\n      } else if (\r\n        resourceType.localeCompare(\"none\") !== 0 &&\r\n        resources.length < 5 &&\r\n        calamityType.localeCompare(\"none\") === 0\r\n      ) {\r\n        setResourcePosition({\r\n          x: e.clientX - earthDimensions.left,\r\n          y: e.clientY - earthDimensions.top,\r\n        });\r\n      }\r\n    } else if (e.button === 2) {\r\n      handleRightClick(e);\r\n    }\r\n  }\r\n\r\n  //handle right click\r\n  function handleRightClick(e) {\r\n    e.preventDefault();\r\n    setContextMenuPosition({\r\n      x: e.clientX - earthDimensions.left,\r\n      y: e.clientY - earthDimensions.top,\r\n    });\r\n  }\r\n\r\n  //set dimensions of earth when reference is available\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      setEarthDimensions({\r\n        top: earthRef.current.offsetTop,\r\n        left: earthRef.current.offsetLeft,\r\n        w: earthRef.current.offsetWidth,\r\n        h: earthRef.current.offsetHeight,\r\n      });\r\n      console.log(earthDimensions);\r\n    }\r\n  }, [earthRef]);\r\n\r\n  //adding contectmenu listener to hide contect menu on right click\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current) {\r\n      earthRef.current.addEventListener(\"contextmenu\", (e) => {\r\n        e.preventDefault();\r\n      });\r\n\r\n      return () => {\r\n        earthRef?.current?.removeEventListener(\"contextmenu\", handleRightClick);\r\n      };\r\n    }\r\n  }, [earthRef]);\r\n\r\n  //restart effect\r\n  useEffect(() => {\r\n    if (restarted) {\r\n      InitializeCreatures(initialPopulation);\r\n    }\r\n  }, [restarted,  initialPopulation]);\r\n\r\n  //add birth and death event handlers when earth reference is available\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      const birthHandler = (e) => {\r\n        if (e.detail) {\r\n          newBirth({\r\n            mother: e.detail.mother,\r\n            father: e.detail.father,\r\n          });\r\n        }\r\n      };\r\n      const deathHandler = (e) => {\r\n        if (e.detail) {\r\n          removeCreatureByUid(e.detail.uid);\r\n        }\r\n      };\r\n      earthRef.current.addEventListener(\"birth\", birthHandler);\r\n      earthRef.current.addEventListener(\"death\", deathHandler);\r\n      return () => {\r\n        earthRef?.current?.removeEventListener(\"birth\", birthHandler);\r\n        earthRef?.current?.removeEventListener(\"death\", deathHandler);\r\n      };\r\n    }\r\n  }, [earthRef, earthRef.current]);\r\n\r\n\r\n  //save population size in global state\r\n  useEffect(()=>{\r\n    setTotalPopulation(creatures.length);\r\n  },[creatures])\r\n\r\n\r\n  return (\r\n    <div\r\n      id=\"earth\"\r\n      ref={earthRef}\r\n      style={{\r\n        backgroundColor: \"#2A2A2A\",\r\n        height: \"100%\",\r\n        width: window.innerWidth - 300,\r\n        overflow: \"hidden\",\r\n        position: \"relative\",\r\n      }}\r\n      onMouseDown={handleLeftClick}\r\n    >\r\n      {resources\r\n        ? resources.map((resource) => {\r\n            if (resource.type.localeCompare(\"waterBody\") === 0) {\r\n              return (\r\n                <WaterBody\r\n                  key={`${resource.id}+resource`}\r\n                  uid={resource.id}\r\n                  size={resource.size}\r\n                  position={resource.position}\r\n                ></WaterBody>\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      {calamities\r\n        ? calamities.map((calamity) => {\r\n            if (calamity.type.localeCompare(\"earthQuake\") === 0) {\r\n              return (\r\n                <EarthQuake\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"volcano\") === 0) {\r\n              return (\r\n                <Volcano\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"radiation\") === 0) {\r\n              return (\r\n                <Radiation\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      {earthRef && earthDimensions\r\n        ? creatures.map((creature) => {\r\n            return (\r\n              <Creature\r\n                birth={creature.birth}\r\n                key={creature.uid}\r\n                uid={creature.uid}\r\n                earthRef={earthRef}\r\n                dim={earthDimensions}\r\n                x={creature.x}\r\n                y={creature.y}\r\n                size={creature.size}\r\n                gender={creature.gender}\r\n              ></Creature>\r\n            );\r\n          })\r\n        : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}