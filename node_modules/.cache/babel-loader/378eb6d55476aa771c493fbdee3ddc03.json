{"ast":null,"code":"import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from\"react\";import{Vector}from\"./vector\";import{Creature}from\"./creature\";import{Wall}from\"./wall\";import{useGlobalState,useGlobalActions}from\"../context/globalContext\";import{Food}from\"./food\";import{jsx as _jsx}from\"react/jsx-runtime\";var isPairEqual=function isPairEqual(a1,b1,a2,b2){// console.log(a1,b1,a2,b2);\nif((a1.localeCompare(a2)===0||a1.localeCompare(b2)===0)&&(b1.localeCompare(a2)===0||b1.localeCompare(b2)===0)){return true;}return false;};function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}function clearCanvas(ctx,canvasRef){var _canvasRef$current,_canvasRef$current2;ctx===null||ctx===void 0?void 0:ctx.clearRect(0,0,canvasRef===null||canvasRef===void 0?void 0:(_canvasRef$current=canvasRef.current)===null||_canvasRef$current===void 0?void 0:_canvasRef$current.clientWidth,canvasRef===null||canvasRef===void 0?void 0:(_canvasRef$current2=canvasRef.current)===null||_canvasRef$current2===void 0?void 0:_canvasRef$current2.clientHeight);}function initPopulation(n,creatures){creatures.current=[];for(var i=0;i<n;i++){var newBall=new Creature(randInt(10,window.innerWidth-300-10),randInt(10,window.innerHeight-10),2,Math.random()>0.5?\"F\":\"M\",creatures);}//   console.log(creatures);\n}function makeInitialFood(foods){foods.current=[];for(var i=0;i<50;i++){var food=new Food(randInt(10,window.innerWidth-300-10),randInt(10,window.innerHeight-10),foods);}}function addRandomNumberOfFood(foods){if(Math.random()>0.8){var food=new Food(randInt(10,window.innerWidth-300-10),randInt(10,window.innerHeight-10),foods);}}function matingPoolWithCacheImplementation(creatures,birthCache){var vis=Array(creatures.current.length).fill(false);var pairs=[];var l=creatures.current.length;// var pairs = 0;\nfor(var i=0;i<l;i++){var observer=creatures.current[i];if(!vis[i]&&observer.gender==\"F\"&&observer.isAdult){vis[i]=true;for(var j=i+1;j<l;j++){var target=creatures.current[j];if(!vis[j]&&target.gender==\"M\"&&target.isAdult&&observer.pos.subtr(target.pos).mag()<5){pairs.push({mother:observer,father:target});vis[j]=true;break;}}}}pairs.forEach(function(_ref){var mother=_ref.mother,father=_ref.father;var canMate=true;for(var _i=0;_i<birthCache.current.length;_i++){var _birthCache$current$_=birthCache.current[_i],cacheMother=_birthCache$current$_.cacheMother,cacheFather=_birthCache$current$_.cacheFather;if(isPairEqual(mother.id,father.id,cacheMother.id,cacheFather.id)){canMate=false;break;}}if(canMate){var newBall=new Creature((mother.pos.x+father.pos.x)/2,(mother.pos.y+father.pos.y)/2,(mother.r+father.r)/2,Math.random()>0.5?\"F\":\"M\",creatures);console.log({mother_y:mother.pos.y,father_y:father.pos.y,newBall:newBall.pos.y});if(birthCache.current.length>creatures.current.length/2){birthCache.current.shift();}birthCache.current.push({cacheMother:mother,cacheFather:father});}});}function matingPool(creatures){var vis=Array(creatures.current.length).fill(false);var pairs=[];var l=creatures.current.length;for(var i=0;i<l;i++){var observer=creatures.current[i];if(!vis[i]&&observer.gender==\"F\"&&observer.isAdult&&observer.isAbleToMate){vis[i]=true;for(var j=i+1;j<l;j++){var target=creatures.current[j];if(!vis[j]&&target.gender==\"M\"&&target.isAdult&&observer.pos.subtr(target.pos).mag()<5){pairs.push({mother:observer,father:target});vis[j]=true;break;}}}}pairs.forEach(function(_ref2){var mother=_ref2.mother,father=_ref2.father;var newBall=new Creature((mother.pos.x+father.pos.x)/2,(mother.pos.y+father.pos.y)/2,(mother.r+father.r)/2,Math.random()>0.5?\"F\":\"M\",creatures);mother.updateNotAbleToMate();});}function findFood(creatures,foods){creatures.current.forEach(function(creature,index){if(!creature.isFoodFound&&creature.canEatFood){for(var _i2=0;_i2<foods.current.length;_i2++){var food=foods.current[_i2];if(food.pos.subtr(creature.pos).mag()<20){creature.updateFoodFound(food.pos,food.id);break;}}}else{if(creature.isFoodFound&&creature.canEatFood&&creature.pos.subtr(creature.foundFoodPosition).mag()<5){var foodIndex=-1;for(var i=0;i<foods.current.length;i++){if(foods.current[i].id.localeCompare(creature.foodId)===0){foodIndex=i;break;}}if(foodIndex!==-1){foods.current.splice(foodIndex,1);creature.updateFoodEaten();creature.updateLastFoodTime();}}}});}function infection(creatures){var n=creatures.current.length;for(var i=0;i<n;i++){var observer=creatures.current[i];if(observer.isInfected){for(var j=i+1;j<n;j++){var target=creatures.current[j];if(observer.pos.subtr(target.pos).mag()<7){target.infect();}}}}}function die(creatures){for(var i=0;i<creatures.current.length;i++){if(creatures.current[i].canDie()){creatures.current.splice(i,1);}}}var Earth=function Earth(){var canvasRef=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),ctx=_useState2[0],setCtx=_useState2[1];var CREATURES=useRef([]);var FOODS=useRef([]);var localSpeed=useRef(0.5);var birthCache=useRef([]);var _useGlobalState=useGlobalState(),restarted=_useGlobalState.restarted,calamityType=_useGlobalState.calamityType,calamities=_useGlobalState.calamities,resources=_useGlobalState.resources,resourceType=_useGlobalState.resourceType,status=_useGlobalState.status,speed=_useGlobalState.speed,initialPopulation=_useGlobalState.initialPopulation;var _useGlobalActions=useGlobalActions(),setTotalPopulation=_useGlobalActions.setTotalPopulation;var localStatus=useRef(status);useEffect(function(){localSpeed.current=speed;},[speed]);useEffect(function(){if(canvasRef&&canvasRef.current){var canvas=document.getElementById(\"canvas\");var _ctx=canvas.getContext(\"2d\");canvasRef.current.focus();setCtx(_ctx);}},[canvasRef]);useEffect(function(){if(ctx){clearCanvas(ctx,canvasRef);initPopulation(initialPopulation,CREATURES);makeInitialFood(FOODS);CREATURES.current[0].infect();}},[ctx,restarted,initialPopulation]);useEffect(function(){var reqID=null;localStatus.current=status;if(status.localeCompare(\"Playing\")===0){reqID=requestAnimationFrame(mainLoop);}return function(){if(reqID){cancelAnimationFrame(reqID);}};},[status]);function mainLoop(timestamp){if(localStatus.current.localeCompare(\"Playing\")===0){clearCanvas(ctx,canvasRef);findFood(CREATURES,FOODS);die(CREATURES);infection(CREATURES);matingPool(CREATURES);CREATURES.current.forEach(function(b,index){b.updateCreature(ctx,localSpeed.current);});FOODS.current.forEach(function(f,index){f.drawFood(ctx);});addRandomNumberOfFood(FOODS);setTotalPopulation(CREATURES.current.length);requestAnimationFrame(mainLoop);}return;}function handleCanvasClick(e){console.log(\"clicked\");var mouse=new Vector(e.clientX,e.clientY);console.log(mouse);var n=CREATURES.current.length;for(var i=0;i<n;i++){var observer=CREATURES.current[i];if(observer.pos.subtr(mouse).mag()<10){observer.infect();}}}return/*#__PURE__*/_jsx(\"canvas\",{onClick:handleCanvasClick,tabIndex:1,id:\"canvas\",ref:canvasRef,width:window.innerWidth-300,height:window.innerHeight,style:{backgroundColor:\"#222222\"}});};export default Earth;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/earth.js"],"names":["useEffect","useRef","useState","Vector","Creature","Wall","useGlobalState","useGlobalActions","Food","isPairEqual","a1","b1","a2","b2","localeCompare","randInt","min","max","Math","floor","random","clearCanvas","ctx","canvasRef","clearRect","current","clientWidth","clientHeight","initPopulation","n","creatures","i","newBall","window","innerWidth","innerHeight","makeInitialFood","foods","food","addRandomNumberOfFood","matingPoolWithCacheImplementation","birthCache","vis","Array","length","fill","pairs","l","observer","gender","isAdult","j","target","pos","subtr","mag","push","mother","father","forEach","canMate","cacheMother","cacheFather","id","x","y","r","console","log","mother_y","father_y","shift","matingPool","isAbleToMate","updateNotAbleToMate","findFood","creature","index","isFoodFound","canEatFood","updateFoodFound","foundFoodPosition","foodIndex","foodId","splice","updateFoodEaten","updateLastFoodTime","infection","isInfected","infect","die","canDie","Earth","setCtx","CREATURES","FOODS","localSpeed","restarted","calamityType","calamities","resources","resourceType","status","speed","initialPopulation","setTotalPopulation","localStatus","canvas","document","getElementById","getContext","focus","reqID","requestAnimationFrame","mainLoop","cancelAnimationFrame","timestamp","b","updateCreature","f","drawFood","handleCanvasClick","e","mouse","clientX","clientY","backgroundColor"],"mappings":"wJAAA,OAASA,SAAT,CAAoBC,MAApB,CAA4BC,QAA5B,KAA4C,OAA5C,CACA,OAASC,MAAT,KAAuB,UAAvB,CACA,OAASC,QAAT,KAAyB,YAAzB,CACA,OAASC,IAAT,KAAqB,QAArB,CACA,OAASC,cAAT,CAAyBC,gBAAzB,KAAiD,0BAAjD,CACA,OAASC,IAAT,KAAqB,QAArB,C,2CAEA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,EAAD,CAAKC,EAAL,CAASC,EAAT,CAAaC,EAAb,CAAoB,CACtC;AACA,GACE,CAACH,EAAE,CAACI,aAAH,CAAiBF,EAAjB,IAAyB,CAAzB,EAA8BF,EAAE,CAACI,aAAH,CAAiBD,EAAjB,IAAyB,CAAxD,IACCF,EAAE,CAACG,aAAH,CAAiBF,EAAjB,IAAyB,CAAzB,EAA8BD,EAAE,CAACG,aAAH,CAAiBD,EAAjB,IAAyB,CADxD,CADF,CAGE,CACA,MAAO,KAAP,CACD,CACD,MAAO,MAAP,CACD,CATD,CAWA,QAASE,CAAAA,OAAT,CAAiBC,GAAjB,CAAsBC,GAAtB,CAA2B,CACzB,MAAOC,CAAAA,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,IAAiBH,GAAG,CAAGD,GAAN,CAAY,CAA7B,CAAX,EAA8CA,GAArD,CACD,CAED,QAASK,CAAAA,WAAT,CAAqBC,GAArB,CAA0BC,SAA1B,CAAqC,4CACnCD,GAAG,OAAH,EAAAA,GAAG,SAAH,QAAAA,GAAG,CAAEE,SAAL,CACE,CADF,CAEE,CAFF,CAGED,SAHF,SAGEA,SAHF,qCAGEA,SAAS,CAAEE,OAHb,6CAGE,mBAAoBC,WAHtB,CAIEH,SAJF,SAIEA,SAJF,sCAIEA,SAAS,CAAEE,OAJb,8CAIE,oBAAoBE,YAJtB,EAMD,CAED,QAASC,CAAAA,cAAT,CAAwBC,CAAxB,CAA2BC,SAA3B,CAAsC,CACpCA,SAAS,CAACL,OAAV,CAAoB,EAApB,CACA,IAAK,GAAIM,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGF,CAApB,CAAuBE,CAAC,EAAxB,CAA4B,CAC1B,GAAIC,CAAAA,OAAO,CAAG,GAAI5B,CAAAA,QAAJ,CACZW,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACC,UAAP,CAAoB,GAApB,CAA0B,EAA/B,CADK,CAEZnB,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACE,WAAP,CAAqB,EAA1B,CAFK,CAGZ,CAHY,CAIZjB,IAAI,CAACE,MAAL,GAAgB,GAAhB,CAAsB,GAAtB,CAA4B,GAJhB,CAKZU,SALY,CAAd,CAOD,CACD;AACD,CAED,QAASM,CAAAA,eAAT,CAAyBC,KAAzB,CAAgC,CAC9BA,KAAK,CAACZ,OAAN,CAAgB,EAAhB,CACA,IAAK,GAAIM,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG,EAApB,CAAwBA,CAAC,EAAzB,CAA6B,CAC3B,GAAMO,CAAAA,IAAI,CAAG,GAAI9B,CAAAA,IAAJ,CACXO,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACC,UAAP,CAAoB,GAApB,CAA0B,EAA/B,CADI,CAEXnB,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACE,WAAP,CAAqB,EAA1B,CAFI,CAGXE,KAHW,CAAb,CAKD,CACF,CAED,QAASE,CAAAA,qBAAT,CAA+BF,KAA/B,CAAsC,CACpC,GAAInB,IAAI,CAACE,MAAL,GAAgB,GAApB,CAAyB,CACvB,GAAMkB,CAAAA,IAAI,CAAG,GAAI9B,CAAAA,IAAJ,CACXO,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACC,UAAP,CAAoB,GAApB,CAA0B,EAA/B,CADI,CAEXnB,OAAO,CAAC,EAAD,CAAKkB,MAAM,CAACE,WAAP,CAAqB,EAA1B,CAFI,CAGXE,KAHW,CAAb,CAKD,CACF,CAED,QAASG,CAAAA,iCAAT,CAA2CV,SAA3C,CAAsDW,UAAtD,CAAkE,CAChE,GAAMC,CAAAA,GAAG,CAAGC,KAAK,CAACb,SAAS,CAACL,OAAV,CAAkBmB,MAAnB,CAAL,CAAgCC,IAAhC,CAAqC,KAArC,CAAZ,CACA,GAAMC,CAAAA,KAAK,CAAG,EAAd,CACA,GAAMC,CAAAA,CAAC,CAAGjB,SAAS,CAACL,OAAV,CAAkBmB,MAA5B,CACA;AACA,IAAK,GAAIb,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGgB,CAApB,CAAuBhB,CAAC,EAAxB,CAA4B,CAC1B,GAAMiB,CAAAA,QAAQ,CAAGlB,SAAS,CAACL,OAAV,CAAkBM,CAAlB,CAAjB,CACA,GAAI,CAACW,GAAG,CAACX,CAAD,CAAJ,EAAWiB,QAAQ,CAACC,MAAT,EAAmB,GAA9B,EAAqCD,QAAQ,CAACE,OAAlD,CAA2D,CACzDR,GAAG,CAACX,CAAD,CAAH,CAAS,IAAT,CACA,IAAK,GAAIoB,CAAAA,CAAC,CAAGpB,CAAC,CAAG,CAAjB,CAAoBoB,CAAC,CAAGJ,CAAxB,CAA2BI,CAAC,EAA5B,CAAgC,CAC9B,GAAMC,CAAAA,MAAM,CAAGtB,SAAS,CAACL,OAAV,CAAkB0B,CAAlB,CAAf,CACA,GACE,CAACT,GAAG,CAACS,CAAD,CAAJ,EACAC,MAAM,CAACH,MAAP,EAAiB,GADjB,EAEAG,MAAM,CAACF,OAFP,EAGAF,QAAQ,CAACK,GAAT,CAAaC,KAAb,CAAmBF,MAAM,CAACC,GAA1B,EAA+BE,GAA/B,GAAuC,CAJzC,CAKE,CACAT,KAAK,CAACU,IAAN,CAAW,CAAEC,MAAM,CAAET,QAAV,CAAoBU,MAAM,CAAEN,MAA5B,CAAX,EACAV,GAAG,CAACS,CAAD,CAAH,CAAS,IAAT,CACA,MACD,CACF,CACF,CACF,CAEDL,KAAK,CAACa,OAAN,CAAc,cAAwB,IAArBF,CAAAA,MAAqB,MAArBA,MAAqB,CAAbC,MAAa,MAAbA,MAAa,CACpC,GAAIE,CAAAA,OAAO,CAAG,IAAd,CACA,IAAK,GAAI7B,CAAAA,EAAC,CAAG,CAAb,CAAgBA,EAAC,CAAGU,UAAU,CAAChB,OAAX,CAAmBmB,MAAvC,CAA+Cb,EAAC,EAAhD,CAAoD,2BACbU,UAAU,CAAChB,OAAX,CAAmBM,EAAnB,CADa,CAC1C8B,WAD0C,uBAC1CA,WAD0C,CAC7BC,WAD6B,uBAC7BA,WAD6B,CAElD,GAAIrD,WAAW,CAACgD,MAAM,CAACM,EAAR,CAAYL,MAAM,CAACK,EAAnB,CAAuBF,WAAW,CAACE,EAAnC,CAAuCD,WAAW,CAACC,EAAnD,CAAf,CAAuE,CACrEH,OAAO,CAAG,KAAV,CACA,MACD,CACF,CAED,GAAIA,OAAJ,CAAa,CACX,GAAI5B,CAAAA,OAAO,CAAG,GAAI5B,CAAAA,QAAJ,CACZ,CAACqD,MAAM,CAACJ,GAAP,CAAWW,CAAX,CAAeN,MAAM,CAACL,GAAP,CAAWW,CAA3B,EAAgC,CADpB,CAEZ,CAACP,MAAM,CAACJ,GAAP,CAAWY,CAAX,CAAeP,MAAM,CAACL,GAAP,CAAWY,CAA3B,EAAgC,CAFpB,CAGZ,CAACR,MAAM,CAACS,CAAP,CAAWR,MAAM,CAACQ,CAAnB,EAAwB,CAHZ,CAIZhD,IAAI,CAACE,MAAL,GAAgB,GAAhB,CAAsB,GAAtB,CAA4B,GAJhB,CAKZU,SALY,CAAd,CAOAqC,OAAO,CAACC,GAAR,CAAY,CACVC,QAAQ,CAAEZ,MAAM,CAACJ,GAAP,CAAWY,CADX,CAEVK,QAAQ,CAAEZ,MAAM,CAACL,GAAP,CAAWY,CAFX,CAGVjC,OAAO,CAAEA,OAAO,CAACqB,GAAR,CAAYY,CAHX,CAAZ,EAKA,GAAIxB,UAAU,CAAChB,OAAX,CAAmBmB,MAAnB,CAA4Bd,SAAS,CAACL,OAAV,CAAkBmB,MAAlB,CAA2B,CAA3D,CAA8D,CAC5DH,UAAU,CAAChB,OAAX,CAAmB8C,KAAnB,GACD,CACD9B,UAAU,CAAChB,OAAX,CAAmB+B,IAAnB,CAAwB,CAAEK,WAAW,CAAEJ,MAAf,CAAuBK,WAAW,CAAEJ,MAApC,CAAxB,EACD,CACF,CA5BD,EA6BD,CAED,QAASc,CAAAA,UAAT,CAAoB1C,SAApB,CAA+B,CAC7B,GAAMY,CAAAA,GAAG,CAAGC,KAAK,CAACb,SAAS,CAACL,OAAV,CAAkBmB,MAAnB,CAAL,CAAgCC,IAAhC,CAAqC,KAArC,CAAZ,CACA,GAAMC,CAAAA,KAAK,CAAG,EAAd,CACA,GAAMC,CAAAA,CAAC,CAAGjB,SAAS,CAACL,OAAV,CAAkBmB,MAA5B,CAEA,IAAK,GAAIb,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGgB,CAApB,CAAuBhB,CAAC,EAAxB,CAA4B,CAC1B,GAAMiB,CAAAA,QAAQ,CAAGlB,SAAS,CAACL,OAAV,CAAkBM,CAAlB,CAAjB,CACA,GACE,CAACW,GAAG,CAACX,CAAD,CAAJ,EACAiB,QAAQ,CAACC,MAAT,EAAmB,GADnB,EAEAD,QAAQ,CAACE,OAFT,EAGAF,QAAQ,CAACyB,YAJX,CAKE,CACA/B,GAAG,CAACX,CAAD,CAAH,CAAS,IAAT,CACA,IAAK,GAAIoB,CAAAA,CAAC,CAAGpB,CAAC,CAAG,CAAjB,CAAoBoB,CAAC,CAAGJ,CAAxB,CAA2BI,CAAC,EAA5B,CAAgC,CAC9B,GAAMC,CAAAA,MAAM,CAAGtB,SAAS,CAACL,OAAV,CAAkB0B,CAAlB,CAAf,CACA,GACE,CAACT,GAAG,CAACS,CAAD,CAAJ,EACAC,MAAM,CAACH,MAAP,EAAiB,GADjB,EAEAG,MAAM,CAACF,OAFP,EAGAF,QAAQ,CAACK,GAAT,CAAaC,KAAb,CAAmBF,MAAM,CAACC,GAA1B,EAA+BE,GAA/B,GAAuC,CAJzC,CAKE,CACAT,KAAK,CAACU,IAAN,CAAW,CAAEC,MAAM,CAAET,QAAV,CAAoBU,MAAM,CAAEN,MAA5B,CAAX,EACAV,GAAG,CAACS,CAAD,CAAH,CAAS,IAAT,CACA,MACD,CACF,CACF,CACF,CACDL,KAAK,CAACa,OAAN,CAAc,eAAwB,IAArBF,CAAAA,MAAqB,OAArBA,MAAqB,CAAbC,MAAa,OAAbA,MAAa,CACpC,GAAI1B,CAAAA,OAAO,CAAG,GAAI5B,CAAAA,QAAJ,CACZ,CAACqD,MAAM,CAACJ,GAAP,CAAWW,CAAX,CAAeN,MAAM,CAACL,GAAP,CAAWW,CAA3B,EAAgC,CADpB,CAEZ,CAACP,MAAM,CAACJ,GAAP,CAAWY,CAAX,CAAeP,MAAM,CAACL,GAAP,CAAWY,CAA3B,EAAgC,CAFpB,CAGZ,CAACR,MAAM,CAACS,CAAP,CAAWR,MAAM,CAACQ,CAAnB,EAAwB,CAHZ,CAIZhD,IAAI,CAACE,MAAL,GAAgB,GAAhB,CAAsB,GAAtB,CAA4B,GAJhB,CAKZU,SALY,CAAd,CAOA2B,MAAM,CAACiB,mBAAP,GACD,CATD,EAUD,CAED,QAASC,CAAAA,QAAT,CAAkB7C,SAAlB,CAA6BO,KAA7B,CAAoC,CAClCP,SAAS,CAACL,OAAV,CAAkBkC,OAAlB,CAA0B,SAACiB,QAAD,CAAWC,KAAX,CAAqB,CAC7C,GAAI,CAACD,QAAQ,CAACE,WAAV,EAAyBF,QAAQ,CAACG,UAAtC,CAAkD,CAChD,IAAK,GAAIhD,CAAAA,GAAC,CAAG,CAAb,CAAgBA,GAAC,CAAGM,KAAK,CAACZ,OAAN,CAAcmB,MAAlC,CAA0Cb,GAAC,EAA3C,CAA+C,CAC7C,GAAMO,CAAAA,IAAI,CAAGD,KAAK,CAACZ,OAAN,CAAcM,GAAd,CAAb,CACA,GAAIO,IAAI,CAACe,GAAL,CAASC,KAAT,CAAesB,QAAQ,CAACvB,GAAxB,EAA6BE,GAA7B,GAAqC,EAAzC,CAA6C,CAC3CqB,QAAQ,CAACI,eAAT,CAAyB1C,IAAI,CAACe,GAA9B,CAAmCf,IAAI,CAACyB,EAAxC,EACA,MACD,CACF,CACF,CARD,IAQO,CACL,GACEa,QAAQ,CAACE,WAAT,EACAF,QAAQ,CAACG,UADT,EAEAH,QAAQ,CAACvB,GAAT,CAAaC,KAAb,CAAmBsB,QAAQ,CAACK,iBAA5B,EAA+C1B,GAA/C,GAAuD,CAHzD,CAIE,CACA,GAAI2B,CAAAA,SAAS,CAAG,CAAC,CAAjB,CACA,IAAK,GAAInD,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGM,KAAK,CAACZ,OAAN,CAAcmB,MAAlC,CAA0Cb,CAAC,EAA3C,CAA+C,CAC7C,GAAIM,KAAK,CAACZ,OAAN,CAAcM,CAAd,EAAiBgC,EAAjB,CAAoBjD,aAApB,CAAkC8D,QAAQ,CAACO,MAA3C,IAAuD,CAA3D,CAA8D,CAC5DD,SAAS,CAAGnD,CAAZ,CACA,MACD,CACF,CACD,GAAImD,SAAS,GAAK,CAAC,CAAnB,CAAsB,CACpB7C,KAAK,CAACZ,OAAN,CAAc2D,MAAd,CAAqBF,SAArB,CAAgC,CAAhC,EACAN,QAAQ,CAACS,eAAT,GACAT,QAAQ,CAACU,kBAAT,GACD,CACF,CACF,CACF,CA7BD,EA8BD,CAED,QAASC,CAAAA,SAAT,CAAmBzD,SAAnB,CAA8B,CAC5B,GAAID,CAAAA,CAAC,CAAGC,SAAS,CAACL,OAAV,CAAkBmB,MAA1B,CACA,IAAK,GAAIb,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGF,CAApB,CAAuBE,CAAC,EAAxB,CAA4B,CAC1B,GAAMiB,CAAAA,QAAQ,CAAGlB,SAAS,CAACL,OAAV,CAAkBM,CAAlB,CAAjB,CACA,GAAIiB,QAAQ,CAACwC,UAAb,CAAyB,CACvB,IAAK,GAAIrC,CAAAA,CAAC,CAAGpB,CAAC,CAAG,CAAjB,CAAoBoB,CAAC,CAAGtB,CAAxB,CAA2BsB,CAAC,EAA5B,CAAgC,CAC9B,GAAMC,CAAAA,MAAM,CAAGtB,SAAS,CAACL,OAAV,CAAkB0B,CAAlB,CAAf,CACA,GAAIH,QAAQ,CAACK,GAAT,CAAaC,KAAb,CAAmBF,MAAM,CAACC,GAA1B,EAA+BE,GAA/B,GAAuC,CAA3C,CAA8C,CAC5CH,MAAM,CAACqC,MAAP,GACD,CACF,CACF,CACF,CACF,CAED,QAASC,CAAAA,GAAT,CAAa5D,SAAb,CAAwB,CACtB,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,SAAS,CAACL,OAAV,CAAkBmB,MAAtC,CAA8Cb,CAAC,EAA/C,CAAmD,CACjD,GAAID,SAAS,CAACL,OAAV,CAAkBM,CAAlB,EAAqB4D,MAArB,EAAJ,CAAmC,CACjC7D,SAAS,CAACL,OAAV,CAAkB2D,MAAlB,CAAyBrD,CAAzB,CAA4B,CAA5B,EACD,CACF,CACF,CAED,GAAM6D,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,EAAM,CAClB,GAAMrE,CAAAA,SAAS,CAAGtB,MAAM,CAAC,IAAD,CAAxB,CADkB,cAEIC,QAAQ,CAAC,IAAD,CAFZ,wCAEXoB,GAFW,eAENuE,MAFM,eAGlB,GAAMC,CAAAA,SAAS,CAAG7F,MAAM,CAAC,EAAD,CAAxB,CACA,GAAM8F,CAAAA,KAAK,CAAG9F,MAAM,CAAC,EAAD,CAApB,CACA,GAAM+F,CAAAA,UAAU,CAAG/F,MAAM,CAAC,GAAD,CAAzB,CACA,GAAMwC,CAAAA,UAAU,CAAGxC,MAAM,CAAC,EAAD,CAAzB,CANkB,oBAgBdK,cAAc,EAhBA,CAQhB2F,SARgB,iBAQhBA,SARgB,CAShBC,YATgB,iBAShBA,YATgB,CAUhBC,UAVgB,iBAUhBA,UAVgB,CAWhBC,SAXgB,iBAWhBA,SAXgB,CAYhBC,YAZgB,iBAYhBA,YAZgB,CAahBC,MAbgB,iBAahBA,MAbgB,CAchBC,KAdgB,iBAchBA,KAdgB,CAehBC,iBAfgB,iBAehBA,iBAfgB,uBAkBajG,gBAAgB,EAlB7B,CAkBVkG,kBAlBU,mBAkBVA,kBAlBU,CAmBlB,GAAMC,CAAAA,WAAW,CAAGzG,MAAM,CAACqG,MAAD,CAA1B,CAEAtG,SAAS,CAAC,UAAM,CACdgG,UAAU,CAACvE,OAAX,CAAqB8E,KAArB,CACD,CAFQ,CAEN,CAACA,KAAD,CAFM,CAAT,CAGAvG,SAAS,CAAC,UAAM,CACd,GAAIuB,SAAS,EAAIA,SAAS,CAACE,OAA3B,CAAoC,CAClC,GAAMkF,CAAAA,MAAM,CAAGC,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAf,CACA,GAAMvF,CAAAA,IAAG,CAAGqF,MAAM,CAACG,UAAP,CAAkB,IAAlB,CAAZ,CACAvF,SAAS,CAACE,OAAV,CAAkBsF,KAAlB,GACAlB,MAAM,CAACvE,IAAD,CAAN,CACD,CACF,CAPQ,CAON,CAACC,SAAD,CAPM,CAAT,CASAvB,SAAS,CAAC,UAAM,CACd,GAAIsB,GAAJ,CAAS,CACPD,WAAW,CAACC,GAAD,CAAMC,SAAN,CAAX,CACAK,cAAc,CAAC4E,iBAAD,CAAoBV,SAApB,CAAd,CACA1D,eAAe,CAAC2D,KAAD,CAAf,CACAD,SAAS,CAACrE,OAAV,CAAkB,CAAlB,EAAqBgE,MAArB,GACD,CACF,CAPQ,CAON,CAACnE,GAAD,CAAM2E,SAAN,CAAiBO,iBAAjB,CAPM,CAAT,CASAxG,SAAS,CAAC,UAAM,CACd,GAAIgH,CAAAA,KAAK,CAAG,IAAZ,CACAN,WAAW,CAACjF,OAAZ,CAAsB6E,MAAtB,CACA,GAAIA,MAAM,CAACxF,aAAP,CAAqB,SAArB,IAAoC,CAAxC,CAA2C,CACzCkG,KAAK,CAAGC,qBAAqB,CAACC,QAAD,CAA7B,CACD,CACD,MAAO,WAAM,CACX,GAAIF,KAAJ,CAAW,CACTG,oBAAoB,CAACH,KAAD,CAApB,CACD,CACF,CAJD,CAKD,CAXQ,CAWN,CAACV,MAAD,CAXM,CAAT,CAaA,QAASY,CAAAA,QAAT,CAAkBE,SAAlB,CAA6B,CAC3B,GAAIV,WAAW,CAACjF,OAAZ,CAAoBX,aAApB,CAAkC,SAAlC,IAAiD,CAArD,CAAwD,CACtDO,WAAW,CAACC,GAAD,CAAMC,SAAN,CAAX,CACAoD,QAAQ,CAACmB,SAAD,CAAYC,KAAZ,CAAR,CACAL,GAAG,CAACI,SAAD,CAAH,CACAP,SAAS,CAACO,SAAD,CAAT,CACAtB,UAAU,CAACsB,SAAD,CAAV,CAEAA,SAAS,CAACrE,OAAV,CAAkBkC,OAAlB,CAA0B,SAAC0D,CAAD,CAAIxC,KAAJ,CAAc,CACtCwC,CAAC,CAACC,cAAF,CAAiBhG,GAAjB,CAAsB0E,UAAU,CAACvE,OAAjC,EACD,CAFD,EAIAsE,KAAK,CAACtE,OAAN,CAAckC,OAAd,CAAsB,SAAC4D,CAAD,CAAI1C,KAAJ,CAAc,CAClC0C,CAAC,CAACC,QAAF,CAAWlG,GAAX,EACD,CAFD,EAGAiB,qBAAqB,CAACwD,KAAD,CAArB,CACAU,kBAAkB,CAACX,SAAS,CAACrE,OAAV,CAAkBmB,MAAnB,CAAlB,CACAqE,qBAAqB,CAACC,QAAD,CAArB,CACD,CACD,OACD,CAED,QAASO,CAAAA,iBAAT,CAA2BC,CAA3B,CAA8B,CAC5BvD,OAAO,CAACC,GAAR,CAAY,SAAZ,EACA,GAAMuD,CAAAA,KAAK,CAAG,GAAIxH,CAAAA,MAAJ,CAAWuH,CAAC,CAACE,OAAb,CAAsBF,CAAC,CAACG,OAAxB,CAAd,CACA1D,OAAO,CAACC,GAAR,CAAYuD,KAAZ,EACA,GAAM9F,CAAAA,CAAC,CAAGiE,SAAS,CAACrE,OAAV,CAAkBmB,MAA5B,CACA,IAAK,GAAIb,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGF,CAApB,CAAuBE,CAAC,EAAxB,CAA4B,CAC1B,GAAMiB,CAAAA,QAAQ,CAAG8C,SAAS,CAACrE,OAAV,CAAkBM,CAAlB,CAAjB,CACA,GAAIiB,QAAQ,CAACK,GAAT,CAAaC,KAAb,CAAmBqE,KAAnB,EAA0BpE,GAA1B,GAAkC,EAAtC,CAA0C,CACxCP,QAAQ,CAACyC,MAAT,GACD,CACF,CACF,CACD,mBACE,eACE,OAAO,CAAEgC,iBADX,CAEE,QAAQ,CAAE,CAFZ,CAGE,EAAE,CAAC,QAHL,CAIE,GAAG,CAAElG,SAJP,CAKE,KAAK,CAAEU,MAAM,CAACC,UAAP,CAAoB,GAL7B,CAME,MAAM,CAAED,MAAM,CAACE,WANjB,CAOE,KAAK,CAAE,CAAE2F,eAAe,CAAE,SAAnB,CAPT,EADF,CAWD,CApGD,CAsGA,cAAelC,CAAAA,KAAf","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport { Vector } from \"./vector\";\r\nimport { Creature } from \"./creature\";\r\nimport { Wall } from \"./wall\";\r\nimport { useGlobalState, useGlobalActions } from \"../context/globalContext\";\r\nimport { Food } from \"./food\";\r\n\r\nconst isPairEqual = (a1, b1, a2, b2) => {\r\n  // console.log(a1,b1,a2,b2);\r\n  if (\r\n    (a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) &&\r\n    (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nfunction randInt(min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nfunction clearCanvas(ctx, canvasRef) {\r\n  ctx?.clearRect(\r\n    0,\r\n    0,\r\n    canvasRef?.current?.clientWidth,\r\n    canvasRef?.current?.clientHeight\r\n  );\r\n}\r\n\r\nfunction initPopulation(n, creatures) {\r\n  creatures.current = [];\r\n  for (let i = 0; i < n; i++) {\r\n    let newBall = new Creature(\r\n      randInt(10, window.innerWidth - 300 - 10),\r\n      randInt(10, window.innerHeight - 10),\r\n      2,\r\n      Math.random() > 0.5 ? \"F\" : \"M\",\r\n      creatures\r\n    );\r\n  }\r\n  //   console.log(creatures);\r\n}\r\n\r\nfunction makeInitialFood(foods) {\r\n  foods.current = [];\r\n  for (let i = 0; i < 50; i++) {\r\n    const food = new Food(\r\n      randInt(10, window.innerWidth - 300 - 10),\r\n      randInt(10, window.innerHeight - 10),\r\n      foods\r\n    );\r\n  }\r\n}\r\n\r\nfunction addRandomNumberOfFood(foods) {\r\n  if (Math.random() > 0.8) {\r\n    const food = new Food(\r\n      randInt(10, window.innerWidth - 300 - 10),\r\n      randInt(10, window.innerHeight - 10),\r\n      foods\r\n    );\r\n  }\r\n}\r\n\r\nfunction matingPoolWithCacheImplementation(creatures, birthCache) {\r\n  const vis = Array(creatures.current.length).fill(false);\r\n  const pairs = [];\r\n  const l = creatures.current.length;\r\n  // var pairs = 0;\r\n  for (let i = 0; i < l; i++) {\r\n    const observer = creatures.current[i];\r\n    if (!vis[i] && observer.gender == \"F\" && observer.isAdult) {\r\n      vis[i] = true;\r\n      for (let j = i + 1; j < l; j++) {\r\n        const target = creatures.current[j];\r\n        if (\r\n          !vis[j] &&\r\n          target.gender == \"M\" &&\r\n          target.isAdult &&\r\n          observer.pos.subtr(target.pos).mag() < 5\r\n        ) {\r\n          pairs.push({ mother: observer, father: target });\r\n          vis[j] = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  pairs.forEach(({ mother, father }) => {\r\n    let canMate = true;\r\n    for (let i = 0; i < birthCache.current.length; i++) {\r\n      const { cacheMother, cacheFather } = birthCache.current[i];\r\n      if (isPairEqual(mother.id, father.id, cacheMother.id, cacheFather.id)) {\r\n        canMate = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (canMate) {\r\n      let newBall = new Creature(\r\n        (mother.pos.x + father.pos.x) / 2,\r\n        (mother.pos.y + father.pos.y) / 2,\r\n        (mother.r + father.r) / 2,\r\n        Math.random() > 0.5 ? \"F\" : \"M\",\r\n        creatures\r\n      );\r\n      console.log({\r\n        mother_y: mother.pos.y,\r\n        father_y: father.pos.y,\r\n        newBall: newBall.pos.y,\r\n      });\r\n      if (birthCache.current.length > creatures.current.length / 2) {\r\n        birthCache.current.shift();\r\n      }\r\n      birthCache.current.push({ cacheMother: mother, cacheFather: father });\r\n    }\r\n  });\r\n}\r\n\r\nfunction matingPool(creatures) {\r\n  const vis = Array(creatures.current.length).fill(false);\r\n  const pairs = [];\r\n  const l = creatures.current.length;\r\n\r\n  for (let i = 0; i < l; i++) {\r\n    const observer = creatures.current[i];\r\n    if (\r\n      !vis[i] &&\r\n      observer.gender == \"F\" &&\r\n      observer.isAdult &&\r\n      observer.isAbleToMate\r\n    ) {\r\n      vis[i] = true;\r\n      for (let j = i + 1; j < l; j++) {\r\n        const target = creatures.current[j];\r\n        if (\r\n          !vis[j] &&\r\n          target.gender == \"M\" &&\r\n          target.isAdult &&\r\n          observer.pos.subtr(target.pos).mag() < 5\r\n        ) {\r\n          pairs.push({ mother: observer, father: target });\r\n          vis[j] = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  pairs.forEach(({ mother, father }) => {\r\n    let newBall = new Creature(\r\n      (mother.pos.x + father.pos.x) / 2,\r\n      (mother.pos.y + father.pos.y) / 2,\r\n      (mother.r + father.r) / 2,\r\n      Math.random() > 0.5 ? \"F\" : \"M\",\r\n      creatures\r\n    );\r\n    mother.updateNotAbleToMate();\r\n  });\r\n}\r\n\r\nfunction findFood(creatures, foods) {\r\n  creatures.current.forEach((creature, index) => {\r\n    if (!creature.isFoodFound && creature.canEatFood) {\r\n      for (let i = 0; i < foods.current.length; i++) {\r\n        const food = foods.current[i];\r\n        if (food.pos.subtr(creature.pos).mag() < 20) {\r\n          creature.updateFoodFound(food.pos, food.id);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        creature.isFoodFound &&\r\n        creature.canEatFood &&\r\n        creature.pos.subtr(creature.foundFoodPosition).mag() < 5\r\n      ) {\r\n        let foodIndex = -1;\r\n        for (var i = 0; i < foods.current.length; i++) {\r\n          if (foods.current[i].id.localeCompare(creature.foodId) === 0) {\r\n            foodIndex = i;\r\n            break;\r\n          }\r\n        }\r\n        if (foodIndex !== -1) {\r\n          foods.current.splice(foodIndex, 1);\r\n          creature.updateFoodEaten();\r\n          creature.updateLastFoodTime();\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction infection(creatures) {\r\n  let n = creatures.current.length;\r\n  for (let i = 0; i < n; i++) {\r\n    const observer = creatures.current[i];\r\n    if (observer.isInfected) {\r\n      for (let j = i + 1; j < n; j++) {\r\n        const target = creatures.current[j];\r\n        if (observer.pos.subtr(target.pos).mag() < 7) {\r\n          target.infect();\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction die(creatures) {\r\n  for (let i = 0; i < creatures.current.length; i++) {\r\n    if (creatures.current[i].canDie()) {\r\n      creatures.current.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nconst Earth = () => {\r\n  const canvasRef = useRef(null);\r\n  const [ctx, setCtx] = useState(null);\r\n  const CREATURES = useRef([]);\r\n  const FOODS = useRef([]);\r\n  const localSpeed = useRef(0.5);\r\n  const birthCache = useRef([]);\r\n  const {\r\n    restarted,\r\n    calamityType,\r\n    calamities,\r\n    resources,\r\n    resourceType,\r\n    status,\r\n    speed,\r\n    initialPopulation,\r\n  } = useGlobalState();\r\n\r\n  const { setTotalPopulation } = useGlobalActions();\r\n  const localStatus = useRef(status);\r\n\r\n  useEffect(() => {\r\n    localSpeed.current = speed;\r\n  }, [speed]);\r\n  useEffect(() => {\r\n    if (canvasRef && canvasRef.current) {\r\n      const canvas = document.getElementById(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n      canvasRef.current.focus();\r\n      setCtx(ctx);\r\n    }\r\n  }, [canvasRef]);\r\n\r\n  useEffect(() => {\r\n    if (ctx) {\r\n      clearCanvas(ctx, canvasRef);\r\n      initPopulation(initialPopulation, CREATURES);\r\n      makeInitialFood(FOODS);\r\n      CREATURES.current[0].infect();\r\n    }\r\n  }, [ctx, restarted, initialPopulation]);\r\n\r\n  useEffect(() => {\r\n    let reqID = null;\r\n    localStatus.current = status;\r\n    if (status.localeCompare(\"Playing\") === 0) {\r\n      reqID = requestAnimationFrame(mainLoop);\r\n    }\r\n    return () => {\r\n      if (reqID) {\r\n        cancelAnimationFrame(reqID);\r\n      }\r\n    };\r\n  }, [status]);\r\n\r\n  function mainLoop(timestamp) {\r\n    if (localStatus.current.localeCompare(\"Playing\") === 0) {\r\n      clearCanvas(ctx, canvasRef);\r\n      findFood(CREATURES, FOODS);\r\n      die(CREATURES);\r\n      infection(CREATURES);\r\n      matingPool(CREATURES);\r\n\r\n      CREATURES.current.forEach((b, index) => {\r\n        b.updateCreature(ctx, localSpeed.current);\r\n      });\r\n\r\n      FOODS.current.forEach((f, index) => {\r\n        f.drawFood(ctx);\r\n      });\r\n      addRandomNumberOfFood(FOODS);\r\n      setTotalPopulation(CREATURES.current.length);\r\n      requestAnimationFrame(mainLoop);\r\n    }\r\n    return;\r\n  }\r\n\r\n  function handleCanvasClick(e) {\r\n    console.log(\"clicked\");\r\n    const mouse = new Vector(e.clientX, e.clientY);\r\n    console.log(mouse);\r\n    const n = CREATURES.current.length;\r\n    for (let i = 0; i < n; i++) {\r\n      const observer = CREATURES.current[i];\r\n      if (observer.pos.subtr(mouse).mag() < 10) {\r\n        observer.infect();\r\n      }\r\n    }\r\n  }\r\n  return (\r\n    <canvas\r\n      onClick={handleCanvasClick}\r\n      tabIndex={1}\r\n      id=\"canvas\"\r\n      ref={canvasRef}\r\n      width={window.innerWidth - 300}\r\n      height={window.innerHeight}\r\n      style={{ backgroundColor: \"#222222\" }}\r\n    ></canvas>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}