{"ast":null,"code":"var _jsxFileName = \"E:\\\\projects\\\\Fun\\\\genetic algorithm\\\\src\\\\components\\\\experiments\\\\earth.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { Vector } from \"./vector\";\nimport { Creature } from \"./creature\";\nimport { Wall } from \"./wall\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BALLS = [];\nconst WALLS = [];\n\nconst isPairEqual = (a1, b1, a2, b2) => {\n  // console.log(a1,b1,a2,b2);\n  if ((a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) && (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)) {\n    return true;\n  }\n\n  return false;\n};\n\nfunction randInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction clearCanvas(ctx, canvasRef) {\n  var _canvasRef$current, _canvasRef$current2;\n\n  ctx === null || ctx === void 0 ? void 0 : ctx.clearRect(0, 0, canvasRef === null || canvasRef === void 0 ? void 0 : (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.clientWidth, canvasRef === null || canvasRef === void 0 ? void 0 : (_canvasRef$current2 = canvasRef.current) === null || _canvasRef$current2 === void 0 ? void 0 : _canvasRef$current2.clientHeight);\n}\n\nfunction initialPopulation(creatures) {\n  creatures.current = [];\n\n  for (let i = 0; i < 100; i++) {\n    let newBall = new Creature(randInt(0, window.innerWidth - 20), randInt(0, window.innerHeight - 20), 2, Math.random() > 0.5 ? \"F\" : \"M\", creatures.current);\n  } //   console.log(creatures);\n\n}\n\nfunction matingPool(creatures, birthCache) {\n  const vis = Array(creatures.current.length).fill(false);\n  const pairs = [];\n  const l = creatures.current.length; // var pairs = 0;\n\n  for (let i = 0; i < l; i++) {\n    const observer = creatures.current[i];\n\n    if (!vis[i] && observer.gender == \"F\") {\n      vis[i] = true;\n\n      for (let j = i + 1; j < l; j++) {\n        const target = creatures.current[j];\n\n        if (!vis[j] && target.gender == \"M\" && observer.pos.subtr(target.pos).mag() < 10) {\n          pairs.push({\n            mother: observer,\n            father: target\n          });\n          vis[j] = true;\n          break;\n        }\n      }\n    }\n  } // if (Math.random() > 0.5) {\n  //   console.log(pairs.length);\n  // }\n  // pairs.forEach(({ mother, father }) => {\n  //   for (let i = 0; i < birthCache.current.length; i++) {\n  //     const { cacheMother, cacheFather } = birthCache.current[i];\n  //     if (!isPairEqual(mother.id, father.id, cacheMother.id, cacheFather.id)) {\n  //       let newBall = new Creature(\n  //         (mother.pos.x + father.pos.x) / 2,\n  //         (mother.pos.x + father.pos.x) / 2,\n  //         (mother.r + father.r) / 2,\n  //         Math.random() > 0.5 ? \"F\" : \"M\",\n  //         creatures.current\n  //       );\n  //       console.log(\"creature made\");\n  //       if (birthCache.current.length > creatures.current.length / 2) {\n  //         birthCache.current.shift();\n  //       }\n  //       birthCache.current.push({ cacheMother: mother, cacheFather: father });\n  //     }\n  //   }\n  // });\n\n\n  pairs.forEach(({\n    mother,\n    father\n  }) => {\n    let newBall = new Creature((mother.pos.x + father.pos.x) / 2, (mother.pos.x + father.pos.x) / 2, (mother.r + father.r) / 2, Math.random() > 0.5 ? \"F\" : \"M\", creatures.current);\n  });\n}\n\nconst Earth = () => {\n  _s();\n\n  const canvasRef = useRef(null);\n  const [ctx, setCtx] = useState(null);\n  const CREATURES = useRef([]);\n  const birthCache = useRef([]);\n  useEffect(() => {\n    if (canvasRef && canvasRef.current) {\n      const canvas = document.getElementById(\"canvas\");\n      const ctx = canvas.getContext(\"2d\");\n      canvasRef.current.focus();\n      setCtx(ctx);\n    }\n  }, [canvasRef]);\n  useEffect(() => {\n    if (ctx) {\n      clearCanvas(ctx, canvasRef);\n      initialPopulation(CREATURES);\n      const reqID = requestAnimationFrame(mainLoop);\n      return () => {\n        cancelAnimationFrame(reqID);\n      };\n    }\n  }, [ctx]);\n\n  function mainLoop(timestamp) {\n    // console.log(\"Creatures count\", CREATURES.current.length);\n    clearCanvas(ctx, canvasRef);\n    CREATURES.current.forEach((b, index) => {\n      b.reposition(ctx);\n      b.updateColor();\n      b.drawBall(ctx);\n    });\n    matingPool(CREATURES, birthCache);\n    requestAnimationFrame(mainLoop);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    tabIndex: 1,\n    id: \"canvas\",\n    ref: canvasRef,\n    width: window.innerWidth,\n    height: window.innerHeight,\n    style: {\n      backgroundColor: \"#222222\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Earth, \"zfpbMmdDwTYDKEDTtKy9cYHGLL8=\");\n\n_c = Earth;\nexport default Earth;\n\nvar _c;\n\n$RefreshReg$(_c, \"Earth\");","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/experiments/earth.js"],"names":["useEffect","useRef","useState","Vector","Creature","Wall","BALLS","WALLS","isPairEqual","a1","b1","a2","b2","localeCompare","randInt","min","max","Math","floor","random","clearCanvas","ctx","canvasRef","clearRect","current","clientWidth","clientHeight","initialPopulation","creatures","i","newBall","window","innerWidth","innerHeight","matingPool","birthCache","vis","Array","length","fill","pairs","l","observer","gender","j","target","pos","subtr","mag","push","mother","father","forEach","x","r","Earth","setCtx","CREATURES","canvas","document","getElementById","getContext","focus","reqID","requestAnimationFrame","mainLoop","cancelAnimationFrame","timestamp","b","index","reposition","updateColor","drawBall","backgroundColor"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport { Vector } from \"./vector\";\r\nimport { Creature } from \"./creature\";\r\nimport { Wall } from \"./wall\";\r\nconst BALLS = [];\r\nconst WALLS = [];\r\n\r\nconst isPairEqual = (a1, b1, a2, b2) => {\r\n  // console.log(a1,b1,a2,b2);\r\n  if (\r\n    (a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) &&\r\n    (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\nfunction randInt(min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\nfunction clearCanvas(ctx, canvasRef) {\r\n  ctx?.clearRect(\r\n    0,\r\n    0,\r\n    canvasRef?.current?.clientWidth,\r\n    canvasRef?.current?.clientHeight\r\n  );\r\n}\r\nfunction initialPopulation(creatures) {\r\n  creatures.current = [];\r\n  for (let i = 0; i < 100; i++) {\r\n    let newBall = new Creature(\r\n      randInt(0, window.innerWidth - 20),\r\n      randInt(0, window.innerHeight - 20),\r\n      2,\r\n      Math.random() > 0.5 ? \"F\" : \"M\",\r\n      creatures.current\r\n    );\r\n  }\r\n  //   console.log(creatures);\r\n}\r\n\r\nfunction matingPool(creatures, birthCache) {\r\n  const vis = Array(creatures.current.length).fill(false);\r\n  const pairs = [];\r\n  const l = creatures.current.length;\r\n  // var pairs = 0;\r\n  for (let i = 0; i < l; i++) {\r\n    const observer = creatures.current[i];\r\n    if (!vis[i] && observer.gender == \"F\") {\r\n      vis[i] = true;\r\n      for (let j = i + 1; j < l; j++) {\r\n        const target = creatures.current[j];\r\n        if (\r\n          !vis[j] &&\r\n          target.gender == \"M\" &&\r\n          observer.pos.subtr(target.pos).mag() < 10\r\n        ) {\r\n          pairs.push({ mother: observer, father: target });\r\n          vis[j] = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // if (Math.random() > 0.5) {\r\n  //   console.log(pairs.length);\r\n  // }\r\n\r\n  // pairs.forEach(({ mother, father }) => {\r\n  //   for (let i = 0; i < birthCache.current.length; i++) {\r\n  //     const { cacheMother, cacheFather } = birthCache.current[i];\r\n  //     if (!isPairEqual(mother.id, father.id, cacheMother.id, cacheFather.id)) {\r\n  //       let newBall = new Creature(\r\n  //         (mother.pos.x + father.pos.x) / 2,\r\n  //         (mother.pos.x + father.pos.x) / 2,\r\n  //         (mother.r + father.r) / 2,\r\n  //         Math.random() > 0.5 ? \"F\" : \"M\",\r\n  //         creatures.current\r\n  //       );\r\n  //       console.log(\"creature made\");\r\n  //       if (birthCache.current.length > creatures.current.length / 2) {\r\n  //         birthCache.current.shift();\r\n  //       }\r\n  //       birthCache.current.push({ cacheMother: mother, cacheFather: father });\r\n  //     }\r\n  //   }\r\n  // });\r\n\r\n  pairs.forEach(({ mother, father }) => {\r\n    let newBall = new Creature(\r\n      (mother.pos.x + father.pos.x) / 2,\r\n      (mother.pos.x + father.pos.x) / 2,\r\n      (mother.r + father.r) / 2,\r\n      Math.random() > 0.5 ? \"F\" : \"M\",\r\n      creatures.current\r\n    );\r\n  });\r\n}\r\n\r\n\r\nconst Earth = () => {\r\n  const canvasRef = useRef(null);\r\n  const [ctx, setCtx] = useState(null);\r\n  const CREATURES = useRef([]);\r\n  const birthCache = useRef([]);\r\n\r\n  useEffect(() => {\r\n    if (canvasRef && canvasRef.current) {\r\n      const canvas = document.getElementById(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n      canvasRef.current.focus();\r\n      setCtx(ctx);\r\n    }\r\n  }, [canvasRef]);\r\n\r\n  useEffect(() => {\r\n    if (ctx) {\r\n    clearCanvas(ctx, canvasRef);\r\n    initialPopulation(CREATURES);\r\n    const reqID = requestAnimationFrame(mainLoop);\r\n    return () => {\r\n      cancelAnimationFrame(reqID);\r\n    };\r\n    }\r\n  }, [ctx]);\r\n\r\n  function mainLoop(timestamp) {\r\n    // console.log(\"Creatures count\", CREATURES.current.length);\r\n    clearCanvas(ctx, canvasRef);\r\n    CREATURES.current.forEach((b, index) => {\r\n      b.reposition(ctx);\r\n      b.updateColor();\r\n      b.drawBall(ctx);\r\n    });\r\n    matingPool(CREATURES, birthCache);\r\n    requestAnimationFrame(mainLoop);\r\n  }\r\n\r\n  return (\r\n    <canvas\r\n      tabIndex={1}\r\n      id=\"canvas\"\r\n      ref={canvasRef}\r\n      width={window.innerWidth}\r\n      height={window.innerHeight}\r\n      style={{ backgroundColor: \"#222222\" }}\r\n    ></canvas>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}