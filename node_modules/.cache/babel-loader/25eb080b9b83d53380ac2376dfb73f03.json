{"ast":null,"code":"var _jsxFileName = \"E:\\\\projects\\\\Fun\\\\genetic algorithm\\\\src\\\\components\\\\creature.js\",\n    _s = $RefreshSig$();\n\nimport { createRef, useEffect, useRef, useState } from \"react\";\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Creature = props => {\n  _s();\n\n  const {\n    status,\n    speed,\n    calamities,\n    resources\n  } = useGlobalState();\n  const creatureRef = useRef(null);\n  const size = useRef(props.size ? props.size : 6);\n  const [color, setColor] = useState(props.birth + 10000 > Date.now() ? \"#44FFE3\" : props.gender.localeCompare(\"M\") === 0 ? \"#E8FF95\" : \"#FF4489\");\n  const [className, setClassName] = useState(props.birth + 10000 > Date.now() ? \"babyCreature\" : \"adultCreature\");\n  const [position, setPosition] = useState({\n    x: props.x ? props.x : Math.floor((props.dim.w - 20) * Math.random() - size.current / 2 + 10),\n    y: props.y ? props.y : Math.floor((props.dim.h - 20) * Math.random() - size.current / 2 + 10)\n  });\n\n  function increaseSize() {\n    size.current = 10;\n  } //destroy self\n\n\n  function selfDestroy() {\n    var _props$earthRef, _props$earthRef$curre;\n\n    const event = new CustomEvent(\"death\", {\n      detail: {\n        uid: props.uid\n      }\n    });\n    (_props$earthRef = props.earthRef) === null || _props$earthRef === void 0 ? void 0 : (_props$earthRef$curre = _props$earthRef.current) === null || _props$earthRef$curre === void 0 ? void 0 : _props$earthRef$curre.dispatchEvent(event);\n  }\n\n  function destroyNeighbour(neighbourUID) {\n    var _props$earthRef2, _props$earthRef2$curr;\n\n    const event = new CustomEvent(\"death\", {\n      detail: {\n        uid: neighbourUID\n      }\n    });\n    (_props$earthRef2 = props.earthRef) === null || _props$earthRef2 === void 0 ? void 0 : (_props$earthRef2$curr = _props$earthRef2.current) === null || _props$earthRef2$curr === void 0 ? void 0 : _props$earthRef2$curr.dispatchEvent(event);\n  } //check if there is any calamity nearby\n\n\n  function checkCalamity() {\n    if (calamities.length > 0) {\n      for (var i = 0; i < calamities.length; i++) {\n        const xDiff = Math.abs(position.x + size.current / 2 - calamities[i].position.x);\n        const yDiff = Math.abs(position.y + size.current / 2 - calamities[i].position.y);\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\n\n        if (distance < calamities[i].size) {\n          selfDestroy();\n        }\n      }\n    }\n  } //check if there is any water body nearby\n\n\n  function checkResources() {\n    if (resources.length > 0) {\n      for (var i = 0; i < resources.length; i++) {\n        const xDiff = Math.abs(position.x + size.current / 2 - resources[i].position.x);\n        const yDiff = Math.abs(position.y + size.current / 2 - resources[i].position.y);\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\n\n        if (distance < resources[i].size / 2 + 30) {\n          if (distance < resources[i].size / 2) {//do something here asumming the creature becomes wwater animal\n          } else {\n            increaseSize();\n          }\n        }\n      }\n    }\n  }\n\n  function changeColor() {\n    if (props.birth + 10000 < Date.now() && color.localeCompare(\"#44FFE3\") === 0) setColor(props.gender.localeCompare(\"M\") === 0 ? \"#E8FF95\" : \"#FF4489\");\n  }\n\n  function changeClassName() {\n    if (props.birth + 10000 < Date.now() && className.localeCompare(\"babyCreature\") === 0) setClassName(\"adultCreature\");\n  }\n\n  function canReproduce() {\n    if (className.localeCompare(\"adultCreature\") === 0) {\n      return true;\n    } else {\n      return false;\n    }\n  } //change position randomly *update to tendency based position change*\n\n\n  function changePosition() {\n    const pos = [1, -1];\n    const skipX = Math.floor(Math.random() * speed);\n    const skipY = Math.floor(Math.random() * speed);\n    const plusMinusX = Math.floor(Math.random() * 2);\n    const plusMinusY = Math.floor(Math.random() * 2);\n    const newPosition = {\n      x: position.x + pos[plusMinusX] * skipX,\n      y: position.y + pos[plusMinusY] * skipY\n    };\n\n    if (newPosition.x + size.current + 10 > props.dim.w) {\n      newPosition.x = props.dim.w - size.current - 10;\n    }\n\n    if (newPosition.y + size.current + 10 > props.dim.h) {\n      newPosition.y = props.dim.h - size.current - 10;\n    }\n\n    if (newPosition.x < 10) {\n      newPosition.x = 10;\n    }\n\n    if (newPosition.y < 10) {\n      newPosition.y = 10;\n    }\n\n    setPosition(newPosition);\n  } //get all neighbouring adults\n\n\n  function getNeighbourHood() {\n    const maleNeighbours = [];\n    const femaleNeighbours = [];\n\n    if (creatureRef === null || creatureRef === void 0 ? void 0 : creatureRef.current) {\n      var _creatureRef$current, _creatureRef$current$;\n\n      const children = (_creatureRef$current = creatureRef.current) === null || _creatureRef$current === void 0 ? void 0 : (_creatureRef$current$ = _creatureRef$current.parentNode) === null || _creatureRef$current$ === void 0 ? void 0 : _creatureRef$current$.childNodes;\n\n      if (children) {\n        Object.keys(children).forEach(key => {\n          var _children$key;\n\n          if (((_children$key = children[key]) === null || _children$key === void 0 ? void 0 : _children$key.className.localeCompare(\"adultCreature\")) === 0 && Math.abs(children[key].offsetLeft - position.x) < 10 && Math.abs(children[key].offsetTop - position.y) < 10 && children[key].id.localeCompare(props.uid) !== 0) {\n            if (children[key].id[0].localeCompare(\"F\") === 0) {\n              femaleNeighbours.push(children[key]);\n            } else {\n              maleNeighbours.push(children[key]);\n            }\n          }\n        });\n      }\n    }\n\n    const neighbourHood = {\n      maleNeighbours,\n      femaleNeighbours\n    };\n    return neighbourHood;\n  } //send birth request to earth\n\n\n  function birthRequest(neighbour) {\n    var _props$earthRef3, _props$earthRef3$curr;\n\n    const mother = {\n      id: props.uid,\n      position: position,\n      size: size.current\n    };\n    const father = {\n      id: neighbour.id,\n      position: {\n        x: neighbour.offsetLeft,\n        y: neighbour.offsetTop\n      },\n      size: neighbour.clientWidth\n    };\n    const event = new CustomEvent(\"birth\", {\n      detail: {\n        mother,\n        father\n      }\n    });\n    (_props$earthRef3 = props.earthRef) === null || _props$earthRef3 === void 0 ? void 0 : (_props$earthRef3$curr = _props$earthRef3.current) === null || _props$earthRef3$curr === void 0 ? void 0 : _props$earthRef3$curr.dispatchEvent(event);\n  } //regular activity function\n\n\n  function doActivities() {\n    checkCalamity();\n    checkResources();\n    changePosition();\n    changeColor();\n    changeClassName();\n    const {\n      maleNeighbours,\n      femaleNeighbours\n    } = getNeighbourHood();\n\n    if (props.uid[0].localeCompare(\"F\") === 0) {\n      if (canReproduce() && maleNeighbours.length > 0) {\n        birthRequest(maleNeighbours[0]);\n      }\n    } else {\n      if (maleNeighbours.length > 0 && maleNeighbours[0].clientWidth < size.current) {\n        destroyNeighbour(maleNeighbours[0].id);\n      }\n    }\n  }\n\n  useEffect(() => {\n    if (status.localeCompare(\"Playing\") === 0) {\n      const interval = setInterval(() => {\n        doActivities();\n      }, Math.floor(Math.random() * 500) + 10);\n      return () => {\n        clearInterval(interval);\n      };\n    }\n  }, [position, status, speed]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: className,\n    ref: creatureRef,\n    id: props.uid,\n    style: {\n      borderRadius: size.current / 2,\n      height: size.current,\n      width: size.current,\n      backgroundColor: color,\n      position: \"absolute\",\n      top: position.y,\n      left: position.x,\n      transition: \"all 0.5s ease-in-out\",\n      WebkitBoxShadow: props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\",\n      boxShadow: props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 232,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Creature, \"iW92J8QDsuO/nTKhKMpb1O3LC7k=\", false, function () {\n  return [useGlobalState];\n});\n\n_c = Creature;\nexport default Creature;\n\nvar _c;\n\n$RefreshReg$(_c, \"Creature\");","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/creature.js"],"names":["createRef","useEffect","useRef","useState","useGlobalActions","useGlobalState","Creature","props","status","speed","calamities","resources","creatureRef","size","color","setColor","birth","Date","now","gender","localeCompare","className","setClassName","position","setPosition","x","Math","floor","dim","w","random","current","y","h","increaseSize","selfDestroy","event","CustomEvent","detail","uid","earthRef","dispatchEvent","destroyNeighbour","neighbourUID","checkCalamity","length","i","xDiff","abs","yDiff","distance","sqrt","pow","checkResources","changeColor","changeClassName","canReproduce","changePosition","pos","skipX","skipY","plusMinusX","plusMinusY","newPosition","getNeighbourHood","maleNeighbours","femaleNeighbours","children","parentNode","childNodes","Object","keys","forEach","key","offsetLeft","offsetTop","id","push","neighbourHood","birthRequest","neighbour","mother","father","clientWidth","doActivities","interval","setInterval","clearInterval","borderRadius","height","width","backgroundColor","top","left","transition","WebkitBoxShadow","boxShadow"],"mappings":"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","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\n\r\n\r\n\r\n\r\n\r\nconst Creature = (props) => {\r\n  const { status, speed, calamities, resources } = useGlobalState();\r\n  const creatureRef = useRef(null);\r\n  const size = useRef(props.size ? props.size : 6);\r\n  const [color, setColor] = useState(\r\n    props.birth + 10000 > Date.now()\r\n      ? \"#44FFE3\"\r\n      : props.gender.localeCompare(\"M\") === 0\r\n      ? \"#E8FF95\"\r\n      : \"#FF4489\"\r\n  );\r\n  const [className, setClassName] = useState(\r\n    props.birth + 10000 > Date.now() ? \"babyCreature\" : \"adultCreature\"\r\n  );\r\n  const [position, setPosition] = useState({\r\n    x: props.x\r\n      ? props.x\r\n      : Math.floor((props.dim.w - 20) * Math.random() - size.current / 2 + 10),\r\n    y: props.y\r\n      ? props.y\r\n      : Math.floor((props.dim.h - 20) * Math.random() - size.current / 2 + 10),\r\n  });\r\n\r\n  function increaseSize() {\r\n    size.current = 10;\r\n  }\r\n\r\n  //destroy self\r\n  function selfDestroy() {\r\n    const event = new CustomEvent(\"death\", {\r\n      detail: { uid: props.uid },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  function destroyNeighbour(neighbourUID) {\r\n    const event = new CustomEvent(\"death\", {\r\n      detail: { uid: neighbourUID },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  //check if there is any calamity nearby\r\n  function checkCalamity() {\r\n    if (calamities.length > 0) {\r\n      for (var i = 0; i < calamities.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - calamities[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - calamities[i].position.y\r\n        );\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < calamities[i].size) {\r\n          selfDestroy();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //check if there is any water body nearby\r\n  function checkResources() {\r\n    if (resources.length > 0) {\r\n      for (var i = 0; i < resources.length; i++) {\r\n        const xDiff = Math.abs(\r\n          position.x + size.current / 2 - resources[i].position.x\r\n        );\r\n        const yDiff = Math.abs(\r\n          position.y + size.current / 2 - resources[i].position.y\r\n        );\r\n\r\n        const distance = Math.sqrt(Math.pow(xDiff, 2) + Math.pow(yDiff, 2));\r\n\r\n        if (distance < resources[i].size / 2 + 30) {\r\n          if (distance < resources[i].size / 2) {\r\n            //do something here asumming the creature becomes wwater animal\r\n          } else {\r\n            increaseSize();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function changeColor() {\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      color.localeCompare(\"#44FFE3\") === 0\r\n    )\r\n      setColor(props.gender.localeCompare(\"M\") === 0 ? \"#E8FF95\" : \"#FF4489\");\r\n  }\r\n\r\n  function changeClassName() {\r\n    if (\r\n      props.birth + 10000 < Date.now() &&\r\n      className.localeCompare(\"babyCreature\") === 0\r\n    )\r\n      setClassName(\"adultCreature\");\r\n  }\r\n\r\n  function canReproduce() {\r\n    if (className.localeCompare(\"adultCreature\") === 0) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //change position randomly *update to tendency based position change*\r\n  function changePosition() {\r\n    const pos = [1, -1];\r\n    const skipX = Math.floor(Math.random() * speed);\r\n    const skipY = Math.floor(Math.random() * speed);\r\n\r\n    const plusMinusX = Math.floor(Math.random() * 2);\r\n    const plusMinusY = Math.floor(Math.random() * 2);\r\n\r\n    const newPosition = {\r\n      x: position.x + pos[plusMinusX] * skipX,\r\n      y: position.y + pos[plusMinusY] * skipY,\r\n    };\r\n\r\n    if (newPosition.x + size.current + 10 > props.dim.w) {\r\n      newPosition.x = props.dim.w - size.current - 10;\r\n    }\r\n    if (newPosition.y + size.current + 10 > props.dim.h) {\r\n      newPosition.y = props.dim.h - size.current - 10;\r\n    }\r\n    if (newPosition.x < 10) {\r\n      newPosition.x = 10;\r\n    }\r\n    if (newPosition.y < 10) {\r\n      newPosition.y = 10;\r\n    }\r\n\r\n    setPosition(newPosition);\r\n  }\r\n\r\n  //get all neighbouring adults\r\n  function getNeighbourHood() {\r\n    \r\n    const maleNeighbours = [];\r\n    const femaleNeighbours = [];\r\n    if (creatureRef?.current) {\r\n      const children = creatureRef.current?.parentNode?.childNodes;\r\n      if (children) {\r\n        Object.keys(children).forEach((key) => {\r\n          if (\r\n            children[key]?.className.localeCompare(\"adultCreature\") === 0 &&\r\n            Math.abs(children[key].offsetLeft - position.x) < 10 &&\r\n            Math.abs(children[key].offsetTop - position.y) < 10 &&\r\n            children[key].id.localeCompare(props.uid) !== 0\r\n          ) {\r\n            if(children[key].id[0].localeCompare(\"F\")===0){\r\n              femaleNeighbours.push(children[key]);\r\n            }else{\r\n               maleNeighbours.push(children[key]);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    const neighbourHood = {maleNeighbours,femaleNeighbours};\r\n    return neighbourHood;\r\n  }\r\n\r\n  //send birth request to earth\r\n  function birthRequest(neighbour) {\r\n    const mother = { id: props.uid, position: position, size: size.current };\r\n    const father = {\r\n      id: neighbour.id,\r\n      position: {\r\n        x: neighbour.offsetLeft,\r\n        y: neighbour.offsetTop,\r\n      },\r\n      size: neighbour.clientWidth,\r\n    };\r\n\r\n    const event = new CustomEvent(\"birth\", {\r\n      detail: { mother, father },\r\n    });\r\n    props.earthRef?.current?.dispatchEvent(event);\r\n  }\r\n\r\n  //regular activity function\r\n  function doActivities() {\r\n    checkCalamity();\r\n    checkResources();\r\n\r\n    changePosition();\r\n    changeColor();\r\n    changeClassName();\r\n\r\n    const { maleNeighbours,femaleNeighbours } = getNeighbourHood();\r\n    if(props.uid[0].localeCompare(\"F\")===0){\r\n      if(canReproduce()&&maleNeighbours.length>0){\r\n        birthRequest(maleNeighbours[0]);\r\n      }\r\n    }else{\r\n      if (maleNeighbours.length>0 && maleNeighbours[0].clientWidth < size.current){\r\n        destroyNeighbour(maleNeighbours[0].id);\r\n      }\r\n    }\r\n\r\n    \r\n  }\r\n\r\n  useEffect(() => {\r\n    if (status.localeCompare(\"Playing\") === 0) {\r\n      const interval = setInterval(() => {\r\n        doActivities();\r\n      }, Math.floor(Math.random() * 500) + 10);\r\n\r\n      \r\n      return () => {\r\n        clearInterval(interval);\r\n      };\r\n    }\r\n  }, [position, status, speed]);\r\n\r\n  \r\n  return (\r\n    <div\r\n      className={className}\r\n      ref={creatureRef}\r\n      id={props.uid}\r\n      style={{\r\n        borderRadius: size.current / 2,\r\n        height: size.current,\r\n        width: size.current,\r\n        backgroundColor: color,\r\n        position: \"absolute\",\r\n        top: position.y,\r\n        left: position.x,\r\n        transition: \"all 0.5s ease-in-out\",\r\n        WebkitBoxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\",\r\n        boxShadow:\r\n          props.birth + 10000 > Date.now() ? \"0 0 10px #44FFE3\" : \"none\",\r\n      }}\r\n    ></div>\r\n  );\r\n};\r\n\r\nexport default Creature;\r\n"]},"metadata":{},"sourceType":"module"}