{"ast":null,"code":"import _toConsumableArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"E:/projects/Fun/genetic algorithm/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createRef,useEffect,useRef,useState}from\"react\";import{Card}from\"react-bootstrap\";import{v4 as uuidv4}from\"uuid\";import Creature from\"./creature\";import IconButton from\"@material-ui/core/IconButton\";import DehazeIcon from\"@material-ui/icons/Dehaze\";import{useGlobalActions,useGlobalState}from\"../context/globalContext\";import Statisitcs from\"./statistics\";import EarthQuake from\"./earthQuake\";// const demo = Array.from(Array(100).keys());\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Earth=function Earth(){var _useGlobalState=useGlobalState(),status=_useGlobalState.status,restarted=_useGlobalState.restarted,earthQuakePosition=_useGlobalState.earthQuakePosition,earthQuakeDuration=_useGlobalState.earthQuakeDuration;var _useGlobalActions=useGlobalActions(),setEarthQuakePosition=_useGlobalActions.setEarthQuakePosition;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),creatures=_useState2[0],setCreatures=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),earthDimensions=_useState4[0],setEarthDimensions=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isStatsVisible=_useState6[0],setIsStatsVisible=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),mouseOnStats=_useState8[0],setMouseOnStats=_useState8[1];var earthRef=/*#__PURE__*/createRef();var creaturesRef=useRef([]);var birthCache=useRef([]);function newBirth(parents){var birthCacheTemp=birthCache.current;var l=birthCacheTemp.length;var canGiveBirth=true;for(var i=0;i<l;i++){if((birthCacheTemp[i].mother.localeCompare(parents.mother)===0||birthCacheTemp[i].mother.localeCompare(parents.father)===0)&&(birthCacheTemp[i].father.localeCompare(parents.mother)===0||birthCacheTemp[i].father.localeCompare(parents.father)===0)){// console.log(\"BirthCache hit!\", parents, birthCacheTemp);\ncanGiveBirth=false;break;}}if(birthCacheTemp.length===0||canGiveBirth){addNewCreature({x:parents.x,y:parents.y});birthCacheTemp.push(_objectSpread({},parents));}if(birthCacheTemp.length>100){birthCacheTemp.shift();}birthCache.current=birthCacheTemp;}useEffect(function(){if(earthRef&&earthRef.current&&!earthDimensions){var birthHandler=function birthHandler(e){if(e.detail){newBirth({mother:e.detail.mother,father:e.detail.candidates[0].id,x:Math.floor(e.detail.position.x+e.detail.candidates[0].offsetLeft)/2,y:Math.floor(e.detail.position.y+e.detail.candidates[0].offsetTop)/2,positionM:e.detail.position,positionF:{x:e.detail.candidates[0].offsetLeft,y:e.detail.candidates[0].offsetTop}});}};var deathHandler=function deathHandler(e){if(e.detail){removeCreatureByUid(e.detail.uid);}};earthRef.current.addEventListener(\"birth\",birthHandler);earthRef.current.addEventListener(\"death\",deathHandler);return function(){var _earthRef$current,_earthRef$current2;earthRef===null||earthRef===void 0?void 0:(_earthRef$current=earthRef.current)===null||_earthRef$current===void 0?void 0:_earthRef$current.removeEventListener(\"birth\",birthHandler);earthRef===null||earthRef===void 0?void 0:(_earthRef$current2=earthRef.current)===null||_earthRef$current2===void 0?void 0:_earthRef$current2.removeEventListener(\"death\",deathHandler);};}},[earthRef,earthRef.current]);function addNewCreature(props){var creaturesTemp=creaturesRef.current;creaturesTemp.push({uid:uuidv4(),birth:Date.now(),x:props?props.x:null,y:props?props.y:null});setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;}function removeCreatureByUid(uid){var creaturesTemp=creaturesRef.current;for(var i=0;i<creaturesTemp.length;i++){if(creaturesTemp[i].uid.localeCompare(uid)===0){creaturesTemp.splice(i,1);setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;break;}}}function removeRandom(){var creaturesTemp=creaturesRef.current;creaturesTemp.splice(Math.floor(Math.random()*creaturesRef.current.length),1);setCreatures(_toConsumableArray(creaturesTemp));creaturesRef.current=creaturesTemp;}function InitializeCreatures(){creaturesRef.current=[];for(var i=0;i<20;i++){addNewCreature();}}useEffect(function(){if(restarted){InitializeCreatures();}},[restarted]);useEffect(function(){if(earthRef&&earthRef.current&&!earthDimensions){setEarthDimensions({top:earthRef.current.offsetTop,left:earthRef.current.offsetLeft,w:earthRef.current.offsetWidth,h:earthRef.current.offsetHeight});}},[earthRef]);function makeEarthQuake(x,y){var _earthRef$current3;var event=new CustomEvent(\"earthQuake\",{detail:{x:x,y:y}});earthRef===null||earthRef===void 0?void 0:(_earthRef$current3=earthRef.current)===null||_earthRef$current3===void 0?void 0:_earthRef$current3.dispatchEvent(event);}useEffect(function(){if(earthQuakePosition){var interval=setInterval(function(){setEarthQuakePosition(null);},[earthQuakeDuration]);return function(){clearInterval(interval);};}},[earthQuakePosition,earthQuakeDuration]);function handleEarthMouseDown(e){e.preventDefault();if(!mouseOnStats&&!isStatsVisible){if(e.button===0){makeEarthQuake(e.clientX-earthDimensions.left,e.clientY-earthDimensions.top);setEarthQuakePosition({x:e.clientX-earthDimensions.left,y:e.clientY-earthDimensions.top});// addNewCreature({ color: \"#004CFF\" });\n}else{removeRandom();}}}return/*#__PURE__*/_jsxs(\"div\",{id:\"earth\",ref:earthRef,style:{backgroundColor:\"#222222\",height:\"100%\",width:\"100%\"},onMouseDown:handleEarthMouseDown,children:[/*#__PURE__*/_jsx(EarthQuake,{duration:3000,earthRef:earthRef}),earthRef&&earthDimensions?creatures.map(function(creature){return/*#__PURE__*/_jsx(Creature,{birth:creature.birth,uid:creature.uid,earthRef:earthRef,dim:earthDimensions,x:creature.x,y:creature.y},creature.uid);}):null,isStatsVisible===false?/*#__PURE__*/_jsx(IconButton,{onMouseEnter:function onMouseEnter(e){e.preventDefault();setMouseOnStats(true);},onMouseLeave:function onMouseLeave(e){e.preventDefault();setMouseOnStats(false);},style:{position:\"absolute\",top:5,left:5},onClick:function onClick(e){e.preventDefault();setIsStatsVisible(true);},children:/*#__PURE__*/_jsx(DehazeIcon,{style:{color:\"white\"}})}):/*#__PURE__*/_jsx(Statisitcs,{closeStats:function closeStats(){setIsStatsVisible(false);setMouseOnStats(false);},style:{position:\"absolute\",top:5,left:5}})]});};export default Earth;","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/screen.js"],"names":["createRef","useEffect","useRef","useState","Card","v4","uuidv4","Creature","IconButton","DehazeIcon","useGlobalActions","useGlobalState","Statisitcs","EarthQuake","Earth","status","restarted","earthQuakePosition","earthQuakeDuration","setEarthQuakePosition","creatures","setCreatures","earthDimensions","setEarthDimensions","isStatsVisible","setIsStatsVisible","mouseOnStats","setMouseOnStats","earthRef","creaturesRef","birthCache","newBirth","parents","birthCacheTemp","current","l","length","canGiveBirth","i","mother","localeCompare","father","addNewCreature","x","y","push","shift","birthHandler","e","detail","candidates","id","Math","floor","position","offsetLeft","offsetTop","positionM","positionF","deathHandler","removeCreatureByUid","uid","addEventListener","removeEventListener","props","creaturesTemp","birth","Date","now","splice","removeRandom","random","InitializeCreatures","top","left","w","offsetWidth","h","offsetHeight","makeEarthQuake","event","CustomEvent","dispatchEvent","interval","setInterval","clearInterval","handleEarthMouseDown","preventDefault","button","clientX","clientY","backgroundColor","height","width","map","creature","color"],"mappings":"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","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { Card } from \"react-bootstrap\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport Creature from \"./creature\";\r\n\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport DehazeIcon from \"@material-ui/icons/Dehaze\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\nimport Statisitcs from \"./statistics\";\r\nimport EarthQuake from \"./earthQuake\";\r\n\r\n// const demo = Array.from(Array(100).keys());\r\n\r\nconst Earth = () => {\r\n  const {\r\n    status,\r\n    restarted,\r\n    earthQuakePosition,\r\n    earthQuakeDuration,\r\n  } = useGlobalState();\r\n  const { setEarthQuakePosition } = useGlobalActions();\r\n  const [creatures, setCreatures] = useState([]);\r\n  const [earthDimensions, setEarthDimensions] = useState(null);\r\n  const [isStatsVisible, setIsStatsVisible] = useState(false);\r\n  const [mouseOnStats, setMouseOnStats] = useState(false);\r\n  const earthRef = createRef();\r\n  const creaturesRef = useRef([]);\r\n  const birthCache = useRef([]);\r\n\r\n  function newBirth(parents) {\r\n    const birthCacheTemp = birthCache.current;\r\n    const l = birthCacheTemp.length;\r\n\r\n    var canGiveBirth = true;\r\n    for (var i = 0; i < l; i++) {\r\n      if (\r\n        (birthCacheTemp[i].mother.localeCompare(parents.mother) === 0 ||\r\n          birthCacheTemp[i].mother.localeCompare(parents.father) === 0) &&\r\n        (birthCacheTemp[i].father.localeCompare(parents.mother) === 0 ||\r\n          birthCacheTemp[i].father.localeCompare(parents.father) === 0)\r\n      ) {\r\n        // console.log(\"BirthCache hit!\", parents, birthCacheTemp);\r\n        canGiveBirth = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (birthCacheTemp.length === 0 || canGiveBirth) {\r\n      addNewCreature({ x: parents.x, y: parents.y });\r\n      birthCacheTemp.push({ ...parents });\r\n    }\r\n    if (birthCacheTemp.length > 100) {\r\n      birthCacheTemp.shift();\r\n    }\r\n    birthCache.current = birthCacheTemp;\r\n  }\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      const birthHandler = (e) => {\r\n        if (e.detail) {\r\n          newBirth({\r\n            mother: e.detail.mother,\r\n            father: e.detail.candidates[0].id,\r\n            x:\r\n              Math.floor(\r\n                e.detail.position.x + e.detail.candidates[0].offsetLeft\r\n              ) / 2,\r\n            y:\r\n              Math.floor(\r\n                e.detail.position.y + e.detail.candidates[0].offsetTop\r\n              ) / 2,\r\n            positionM: e.detail.position,\r\n            positionF: {\r\n              x: e.detail.candidates[0].offsetLeft,\r\n              y: e.detail.candidates[0].offsetTop,\r\n            },\r\n          });\r\n        }\r\n      };\r\n      const deathHandler = (e) => {\r\n        if (e.detail) {\r\n          removeCreatureByUid(e.detail.uid);\r\n        }\r\n      };\r\n      earthRef.current.addEventListener(\"birth\", birthHandler);\r\n      earthRef.current.addEventListener(\"death\", deathHandler);\r\n      return () => {\r\n        earthRef?.current?.removeEventListener(\"birth\", birthHandler);\r\n        earthRef?.current?.removeEventListener(\"death\", deathHandler);\r\n      };\r\n    }\r\n  }, [earthRef, earthRef.current]);\r\n\r\n  function addNewCreature(props) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    creaturesTemp.push({\r\n      uid: uuidv4(),\r\n      birth: Date.now(),\r\n      x: props ? props.x : null,\r\n      y: props ? props.y : null,\r\n    });\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n  }\r\n\r\n  function removeCreatureByUid(uid) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    for (var i = 0; i < creaturesTemp.length; i++) {\r\n      if (creaturesTemp[i].uid.localeCompare(uid) === 0) {\r\n        creaturesTemp.splice(i, 1);\r\n        setCreatures([...creaturesTemp]);\r\n        creaturesRef.current = creaturesTemp;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  function removeRandom() {\r\n    const creaturesTemp = creaturesRef.current;\r\n    creaturesTemp.splice(\r\n      Math.floor(Math.random() * creaturesRef.current.length),\r\n      1\r\n    );\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n  }\r\n\r\n  function InitializeCreatures() {\r\n    creaturesRef.current = [];\r\n    for (var i = 0; i < 20; i++) {\r\n      addNewCreature();\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    if (restarted) {\r\n      InitializeCreatures();\r\n    }\r\n  }, [restarted]);\r\n\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      setEarthDimensions({\r\n        top: earthRef.current.offsetTop,\r\n        left: earthRef.current.offsetLeft,\r\n        w: earthRef.current.offsetWidth,\r\n        h: earthRef.current.offsetHeight,\r\n      });\r\n    }\r\n  }, [earthRef]);\r\n\r\n  function makeEarthQuake(x, y) {\r\n    const event = new CustomEvent(\"earthQuake\", {\r\n      detail: { x, y },\r\n    });\r\n    earthRef?.current?.dispatchEvent(event);\r\n  }\r\n  useEffect(() => {\r\n    if (earthQuakePosition) {\r\n      const interval = setInterval(() => {\r\n        setEarthQuakePosition(null);\r\n      }, [earthQuakeDuration]);\r\n\r\n      return () => {\r\n        clearInterval(interval);\r\n      };\r\n    }\r\n  }, [earthQuakePosition, earthQuakeDuration]);\r\n\r\n  function handleEarthMouseDown(e) {\r\n    e.preventDefault();\r\n    if (!mouseOnStats && !isStatsVisible) {\r\n      if (e.button === 0) {\r\n        makeEarthQuake(\r\n          e.clientX - earthDimensions.left,\r\n          e.clientY - earthDimensions.top\r\n        );\r\n        setEarthQuakePosition({\r\n          x: e.clientX - earthDimensions.left,\r\n          y: e.clientY - earthDimensions.top,\r\n        });\r\n        // addNewCreature({ color: \"#004CFF\" });\r\n      } else {\r\n        removeRandom();\r\n      }\r\n    }\r\n  }\r\n  return (\r\n    <div\r\n      id=\"earth\"\r\n      ref={earthRef}\r\n      style={{ backgroundColor: \"#222222\", height: \"100%\", width: \"100%\" }}\r\n      onMouseDown={handleEarthMouseDown}\r\n    >\r\n      <EarthQuake duration={3000} earthRef={earthRef}></EarthQuake>\r\n      {earthRef && earthDimensions\r\n        ? creatures.map((creature) => {\r\n            return (\r\n              <Creature\r\n                birth={creature.birth}\r\n                key={creature.uid}\r\n                uid={creature.uid}\r\n                earthRef={earthRef}\r\n                dim={earthDimensions}\r\n                x={creature.x}\r\n                y={creature.y}\r\n              ></Creature>\r\n            );\r\n          })\r\n        : null}\r\n      {isStatsVisible === false ? (\r\n        <IconButton\r\n          onMouseEnter={(e) => {\r\n            e.preventDefault();\r\n            setMouseOnStats(true);\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.preventDefault();\r\n            setMouseOnStats(false);\r\n          }}\r\n          style={{ position: \"absolute\", top: 5, left: 5 }}\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            setIsStatsVisible(true);\r\n          }}\r\n        >\r\n          <DehazeIcon style={{ color: \"white\" }}></DehazeIcon>\r\n        </IconButton>\r\n      ) : (\r\n        <Statisitcs\r\n          closeStats={() => {\r\n            setIsStatsVisible(false);\r\n            setMouseOnStats(false);\r\n          }}\r\n          style={{ position: \"absolute\", top: 5, left: 5 }}\r\n        ></Statisitcs>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}