{"ast":null,"code":"var _jsxFileName = \"E:\\\\projects\\\\Fun\\\\genetic algorithm\\\\src\\\\components\\\\screen.js\",\n    _s = $RefreshSig$();\n\nimport { createRef, useEffect, useRef, useState } from \"react\";\nimport { Card } from \"react-bootstrap\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport Creature from \"./creature\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport DehazeIcon from \"@material-ui/icons/Dehaze\";\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\nimport Statisitcs from \"./statistics\";\nimport EarthQuake from \"./earthQuake\";\nimport Volcano from \"./volcana\";\nimport Radiation from \"./radiation\";\nimport WaterBody from \"./waterBody\"; // const demo = Array.from(Array(100).keys());\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst isPairEqual = (a1, b1, a2, b2) => {\n  // console.log(a1,b1,a2,b2);\n  if ((a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) && (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)) {\n    return true;\n  }\n\n  return false;\n};\n\nconst Earth = () => {\n  _s();\n\n  const {\n    restarted,\n    calamityType,\n    calamities,\n    resources,\n    resourceType,\n    initialPopulation\n  } = useGlobalState();\n  const {\n    setCalamityPosition,\n    setResourcePosition,\n    setTotalPopulation\n  } = useGlobalActions();\n  const [creatures, setCreatures] = useState([]);\n  const [contextMenuPosition, setContextMenuPosition] = useState(null);\n  const [earthDimensions, setEarthDimensions] = useState(null);\n  const earthRef = /*#__PURE__*/createRef();\n  const creaturesRef = useRef([]);\n  const birthCache = useRef([]); //initial population of creatures\n\n  function InitializeCreatures(initialPopulation) {\n    creaturesRef.current = [];\n\n    for (var i = 0; i < initialPopulation; i++) {\n      addNewCreature();\n    }\n  } //add new creature to creaturesRef\n\n\n  function addNewCreature(props) {\n    const creaturesTemp = creaturesRef.current;\n    const gender = Math.random() > 0.5 ? \"M\" : \"F\";\n    const uid = `${gender}-${uuidv4()}`;\n    creaturesTemp.push({\n      uid: uid,\n      birth: Date.now(),\n      x: props === null || props === void 0 ? void 0 : props.x,\n      y: props === null || props === void 0 ? void 0 : props.y,\n      size: props === null || props === void 0 ? void 0 : props.size,\n      gender: gender\n    });\n    setCreatures([...creaturesTemp]);\n    creaturesRef.current = creaturesTemp;\n    return uid;\n  } //remove creature by id from creatureRef\n\n\n  function removeCreatureByUid(uid) {\n    const creaturesTemp = creaturesRef.current;\n\n    for (var i = 0; i < creaturesTemp.length; i++) {\n      if (creaturesTemp[i].uid.localeCompare(uid) === 0) {\n        creaturesTemp.splice(i, 1);\n        setCreatures([...creaturesTemp]);\n        creaturesRef.current = creaturesTemp;\n        break;\n      }\n    }\n  } //remove random creature\n\n\n  function removeRandom() {\n    const creaturesTemp = creaturesRef.current;\n    creaturesTemp.splice(Math.floor(Math.random() * creaturesRef.current.length), 1);\n    setCreatures([...creaturesTemp]);\n    creaturesRef.current = creaturesTemp;\n  } //handle new births wheather the parents have mate recently or not\n\n\n  function newBirth({\n    mother,\n    father\n  }) {\n    const birthCacheTemp = birthCache.current;\n    const l = birthCacheTemp.length;\n    var canGiveBirth = true;\n\n    for (var i = 0; i < l; i++) {\n      if (isPairEqual(birthCacheTemp[i].mother.id, birthCacheTemp[i].father.id, mother.id, father.id)) {\n        console.log(\"birth not allowed!\");\n        canGiveBirth = false;\n        break;\n      }\n    }\n\n    if (canGiveBirth) {\n      const childId = addNewCreature({\n        x: (mother.position.x + father.position.x) / 2,\n        y: (mother.position.y + father.position.y) / 2,\n        size: (mother.size + father.size) / 2\n      });\n      birthCacheTemp.push({\n        mother,\n        father\n      });\n    }\n\n    if (birthCacheTemp.length > 100) {\n      birthCacheTemp.shift();\n    }\n\n    birthCache.current = birthCacheTemp;\n  } //handle left click\n\n\n  function handleLeftClick(e) {\n    e.preventDefault();\n\n    if (e.button === 0) {\n      if (calamityType.localeCompare(\"none\") !== 0 && calamities.length < 5 && resourceType.localeCompare(\"none\") === 0) {\n        setCalamityPosition({\n          x: e.clientX - earthDimensions.left,\n          y: e.clientY - earthDimensions.top\n        });\n      } else if (resourceType.localeCompare(\"none\") !== 0 && resources.length < 5 && calamityType.localeCompare(\"none\") === 0) {\n        setResourcePosition({\n          x: e.clientX - earthDimensions.left,\n          y: e.clientY - earthDimensions.top\n        });\n      }\n    } else if (e.button === 2) {\n      handleRightClick(e);\n    }\n  } //handle right click\n\n\n  function handleRightClick(e) {\n    e.preventDefault();\n    setContextMenuPosition({\n      x: e.clientX - earthDimensions.left,\n      y: e.clientY - earthDimensions.top\n    });\n  } //set dimensions of earth when reference is available\n\n\n  useEffect(() => {\n    if (earthRef && earthRef.current && !earthDimensions) {\n      setEarthDimensions({\n        top: earthRef.current.offsetTop,\n        left: earthRef.current.offsetLeft,\n        w: earthRef.current.offsetWidth,\n        h: earthRef.current.offsetHeight\n      });\n      console.log(earthDimensions);\n    }\n  }, [earthRef]); //adding contectmenu listener to hide contect menu on right click\n\n  useEffect(() => {\n    if (earthRef && earthRef.current) {\n      earthRef.current.addEventListener(\"contextmenu\", e => {\n        e.preventDefault();\n      });\n      return () => {\n        var _earthRef$current;\n\n        earthRef === null || earthRef === void 0 ? void 0 : (_earthRef$current = earthRef.current) === null || _earthRef$current === void 0 ? void 0 : _earthRef$current.removeEventListener(\"contextmenu\", handleRightClick);\n      };\n    }\n  }, [earthRef]); //restart effect\n\n  useEffect(() => {\n    if (restarted) {\n      InitializeCreatures(initialPopulation);\n    }\n  }, [restarted, initialPopulation]); //add birth and death event handlers when earth reference is available\n\n  useEffect(() => {\n    if (earthRef && earthRef.current && !earthDimensions) {\n      const birthHandler = e => {\n        if (e.detail) {\n          newBirth({\n            mother: e.detail.mother,\n            father: e.detail.father\n          });\n        }\n      };\n\n      const deathHandler = e => {\n        if (e.detail) {\n          removeCreatureByUid(e.detail.uid);\n        }\n      };\n\n      earthRef.current.addEventListener(\"birth\", birthHandler);\n      earthRef.current.addEventListener(\"death\", deathHandler);\n      return () => {\n        var _earthRef$current2, _earthRef$current3;\n\n        earthRef === null || earthRef === void 0 ? void 0 : (_earthRef$current2 = earthRef.current) === null || _earthRef$current2 === void 0 ? void 0 : _earthRef$current2.removeEventListener(\"birth\", birthHandler);\n        earthRef === null || earthRef === void 0 ? void 0 : (_earthRef$current3 = earthRef.current) === null || _earthRef$current3 === void 0 ? void 0 : _earthRef$current3.removeEventListener(\"death\", deathHandler);\n      };\n    }\n  }, [earthRef, earthRef.current]); //save population size in global state\n\n  useEffect(() => {\n    setTotalPopulation(creatures.length);\n  }, [creatures]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"earth\",\n    ref: earthRef,\n    style: {\n      backgroundColor: \"#2A2A2A\",\n      height: \"100%\",\n      width: window.innerWidth - 400,\n      overflow: \"hidden\",\n      position: \"relative\"\n    },\n    onMouseDown: handleLeftClick,\n    children: [resources ? resources.map(resource => {\n      if (resource.type.localeCompare(\"waterBody\") === 0) {\n        return /*#__PURE__*/_jsxDEV(WaterBody, {\n          uid: resource.id,\n          size: resource.size,\n          position: resource.position\n        }, `${resource.id}+resource`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 17\n        }, this);\n      }\n    }) : null, calamities ? calamities.map(calamity => {\n      if (calamity.type.localeCompare(\"earthQuake\") === 0) {\n        return /*#__PURE__*/_jsxDEV(EarthQuake, {\n          size: calamity.size,\n          amplitude: calamity.amplitude,\n          duration: calamity.duration,\n          position: calamity.position\n        }, `${calamity.id}+calamity`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 17\n        }, this);\n      } else if (calamity.type.localeCompare(\"volcano\") === 0) {\n        return /*#__PURE__*/_jsxDEV(Volcano, {\n          size: calamity.size,\n          amplitude: calamity.amplitude,\n          duration: calamity.duration,\n          position: calamity.position\n        }, `${calamity.id}+calamity`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 17\n        }, this);\n      } else if (calamity.type.localeCompare(\"radiation\") === 0) {\n        return /*#__PURE__*/_jsxDEV(Radiation, {\n          size: calamity.size,\n          amplitude: calamity.amplitude,\n          duration: calamity.duration,\n          position: calamity.position\n        }, `${calamity.id}+calamity`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 17\n        }, this);\n      }\n    }) : null, earthRef && earthDimensions ? creatures.map(creature => {\n      return /*#__PURE__*/_jsxDEV(Creature, {\n        birth: creature.birth,\n        uid: creature.uid,\n        earthRef: earthRef,\n        dim: earthDimensions,\n        x: creature.x,\n        y: creature.y,\n        size: creature.size,\n        gender: creature.gender\n      }, creature.uid, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 15\n      }, this);\n    }) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 237,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Earth, \"JTyJvYj1TmoFVkylKacO6oECcNY=\", false, function () {\n  return [useGlobalState, useGlobalActions];\n});\n\n_c = Earth;\nexport default Earth;\n\nvar _c;\n\n$RefreshReg$(_c, \"Earth\");","map":{"version":3,"sources":["E:/projects/Fun/genetic algorithm/src/components/screen.js"],"names":["createRef","useEffect","useRef","useState","Card","v4","uuidv4","Creature","IconButton","DehazeIcon","useGlobalActions","useGlobalState","Statisitcs","EarthQuake","Volcano","Radiation","WaterBody","isPairEqual","a1","b1","a2","b2","localeCompare","Earth","restarted","calamityType","calamities","resources","resourceType","initialPopulation","setCalamityPosition","setResourcePosition","setTotalPopulation","creatures","setCreatures","contextMenuPosition","setContextMenuPosition","earthDimensions","setEarthDimensions","earthRef","creaturesRef","birthCache","InitializeCreatures","current","i","addNewCreature","props","creaturesTemp","gender","Math","random","uid","push","birth","Date","now","x","y","size","removeCreatureByUid","length","splice","removeRandom","floor","newBirth","mother","father","birthCacheTemp","l","canGiveBirth","id","console","log","childId","position","shift","handleLeftClick","e","preventDefault","button","clientX","left","clientY","top","handleRightClick","offsetTop","offsetLeft","w","offsetWidth","h","offsetHeight","addEventListener","removeEventListener","birthHandler","detail","deathHandler","backgroundColor","height","width","window","innerWidth","overflow","map","resource","type","calamity","amplitude","duration","creature"],"mappings":"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","sourcesContent":["import { createRef, useEffect, useRef, useState } from \"react\";\r\nimport { Card } from \"react-bootstrap\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport Creature from \"./creature\";\r\n\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport DehazeIcon from \"@material-ui/icons/Dehaze\";\r\nimport { useGlobalActions, useGlobalState } from \"../context/globalContext\";\r\nimport Statisitcs from \"./statistics\";\r\nimport EarthQuake from \"./earthQuake\";\r\nimport Volcano from \"./volcana\";\r\nimport Radiation from \"./radiation\";\r\nimport WaterBody from \"./waterBody\";\r\n\r\n// const demo = Array.from(Array(100).keys());\r\n\r\n\r\n\r\n\r\n\r\nconst isPairEqual = (a1, b1, a2, b2) => {\r\n  // console.log(a1,b1,a2,b2);\r\n  if (\r\n    (a1.localeCompare(a2) === 0 || a1.localeCompare(b2) === 0) &&\r\n    (b1.localeCompare(a2) === 0 || b1.localeCompare(b2) === 0)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nconst Earth = () => {\r\n  const {\r\n    restarted,\r\n    calamityType,\r\n    calamities,\r\n    resources,\r\n    resourceType,\r\n    initialPopulation,\r\n  } = useGlobalState();\r\n  const { setCalamityPosition, setResourcePosition,setTotalPopulation } = useGlobalActions();\r\n  const [creatures, setCreatures] = useState([]);\r\n  const [contextMenuPosition, setContextMenuPosition] = useState(null);\r\n  const [earthDimensions, setEarthDimensions] = useState(null);\r\n  const earthRef = createRef();\r\n  const creaturesRef = useRef([]);\r\n  const birthCache = useRef([]);\r\n\r\n  //initial population of creatures\r\n  function InitializeCreatures(initialPopulation) {\r\n    creaturesRef.current = [];\r\n    for (var i = 0; i < initialPopulation; i++) {\r\n      addNewCreature();\r\n    }\r\n  }\r\n\r\n  //add new creature to creaturesRef\r\n  function addNewCreature(props) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    const gender = Math.random()>0.5?\"M\":\"F\";\r\n    const uid = `${gender}-${uuidv4()}`;\r\n    creaturesTemp.push({\r\n      uid: uid,\r\n      birth: Date.now(),\r\n      x: props?.x,\r\n      y: props?.y,\r\n      size: props?.size,\r\n      gender:gender\r\n    });\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n    return uid;\r\n  }\r\n\r\n  //remove creature by id from creatureRef\r\n  function removeCreatureByUid(uid) {\r\n    const creaturesTemp = creaturesRef.current;\r\n    for (var i = 0; i < creaturesTemp.length; i++) {\r\n      if (creaturesTemp[i].uid.localeCompare(uid) === 0) {\r\n        creaturesTemp.splice(i, 1);\r\n        setCreatures([...creaturesTemp]);\r\n        creaturesRef.current = creaturesTemp;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  //remove random creature\r\n  function removeRandom() {\r\n    const creaturesTemp = creaturesRef.current;\r\n    creaturesTemp.splice(\r\n      Math.floor(Math.random() * creaturesRef.current.length),\r\n      1\r\n    );\r\n    setCreatures([...creaturesTemp]);\r\n    creaturesRef.current = creaturesTemp;\r\n  }\r\n\r\n  //handle new births wheather the parents have mate recently or not\r\n  function newBirth({ mother, father }) {\r\n    const birthCacheTemp = birthCache.current;\r\n    const l = birthCacheTemp.length;\r\n\r\n    var canGiveBirth = true;\r\n    for (var i = 0; i < l; i++) {\r\n      if (\r\n        isPairEqual(\r\n          birthCacheTemp[i].mother.id,\r\n          birthCacheTemp[i].father.id,\r\n          mother.id,\r\n          father.id\r\n        )\r\n      ) {\r\n        console.log(\"birth not allowed!\");\r\n        canGiveBirth = false;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (canGiveBirth) {\r\n      const childId = addNewCreature({\r\n        x: (mother.position.x + father.position.x) / 2,\r\n        y: (mother.position.y + father.position.y) / 2,\r\n        size: (mother.size + father.size) / 2,\r\n      });\r\n      birthCacheTemp.push({ mother, father });\r\n    }\r\n    if (birthCacheTemp.length > 100) {\r\n      birthCacheTemp.shift();\r\n    }\r\n    birthCache.current = birthCacheTemp;\r\n  }\r\n\r\n  //handle left click\r\n  function handleLeftClick(e) {\r\n    e.preventDefault();\r\n    if (e.button === 0) {\r\n      if (\r\n        calamityType.localeCompare(\"none\") !== 0 &&\r\n        calamities.length < 5 &&\r\n        resourceType.localeCompare(\"none\") === 0\r\n      ) {\r\n        setCalamityPosition({\r\n          x: e.clientX - earthDimensions.left,\r\n          y: e.clientY - earthDimensions.top,\r\n        });\r\n      } else if (\r\n        resourceType.localeCompare(\"none\") !== 0 &&\r\n        resources.length < 5 &&\r\n        calamityType.localeCompare(\"none\") === 0\r\n      ) {\r\n        setResourcePosition({\r\n          x: e.clientX - earthDimensions.left,\r\n          y: e.clientY - earthDimensions.top,\r\n        });\r\n      }\r\n    } else if (e.button === 2) {\r\n      handleRightClick(e);\r\n    }\r\n  }\r\n\r\n  //handle right click\r\n  function handleRightClick(e) {\r\n    e.preventDefault();\r\n    setContextMenuPosition({\r\n      x: e.clientX - earthDimensions.left,\r\n      y: e.clientY - earthDimensions.top,\r\n    });\r\n  }\r\n\r\n  //set dimensions of earth when reference is available\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      setEarthDimensions({\r\n        top: earthRef.current.offsetTop,\r\n        left: earthRef.current.offsetLeft,\r\n        w: earthRef.current.offsetWidth,\r\n        h: earthRef.current.offsetHeight,\r\n      });\r\n      console.log(earthDimensions);\r\n    }\r\n  }, [earthRef]);\r\n\r\n  //adding contectmenu listener to hide contect menu on right click\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current) {\r\n      earthRef.current.addEventListener(\"contextmenu\", (e) => {\r\n        e.preventDefault();\r\n      });\r\n\r\n      return () => {\r\n        earthRef?.current?.removeEventListener(\"contextmenu\", handleRightClick);\r\n      };\r\n    }\r\n  }, [earthRef]);\r\n\r\n  //restart effect\r\n  useEffect(() => {\r\n    if (restarted) {\r\n      InitializeCreatures(initialPopulation);\r\n    }\r\n  }, [restarted,  initialPopulation]);\r\n\r\n  //add birth and death event handlers when earth reference is available\r\n  useEffect(() => {\r\n    if (earthRef && earthRef.current && !earthDimensions) {\r\n      const birthHandler = (e) => {\r\n        if (e.detail) {\r\n          newBirth({\r\n            mother: e.detail.mother,\r\n            father: e.detail.father,\r\n          });\r\n        }\r\n      };\r\n      const deathHandler = (e) => {\r\n        if (e.detail) {\r\n          removeCreatureByUid(e.detail.uid);\r\n        }\r\n      };\r\n      earthRef.current.addEventListener(\"birth\", birthHandler);\r\n      earthRef.current.addEventListener(\"death\", deathHandler);\r\n      return () => {\r\n        earthRef?.current?.removeEventListener(\"birth\", birthHandler);\r\n        earthRef?.current?.removeEventListener(\"death\", deathHandler);\r\n      };\r\n    }\r\n  }, [earthRef, earthRef.current]);\r\n\r\n\r\n  //save population size in global state\r\n  useEffect(()=>{\r\n    setTotalPopulation(creatures.length);\r\n  },[creatures])\r\n\r\n\r\n  return (\r\n    <div\r\n      id=\"earth\"\r\n      ref={earthRef}\r\n      style={{\r\n        backgroundColor: \"#2A2A2A\",\r\n        height: \"100%\",\r\n        width: window.innerWidth - 400,\r\n        overflow: \"hidden\",\r\n        position: \"relative\",\r\n      }}\r\n      onMouseDown={handleLeftClick}\r\n    >\r\n      {resources\r\n        ? resources.map((resource) => {\r\n            if (resource.type.localeCompare(\"waterBody\") === 0) {\r\n              return (\r\n                <WaterBody\r\n                  key={`${resource.id}+resource`}\r\n                  uid={resource.id}\r\n                  size={resource.size}\r\n                  position={resource.position}\r\n                ></WaterBody>\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      {calamities\r\n        ? calamities.map((calamity) => {\r\n            if (calamity.type.localeCompare(\"earthQuake\") === 0) {\r\n              return (\r\n                <EarthQuake\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"volcano\") === 0) {\r\n              return (\r\n                <Volcano\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            } else if (calamity.type.localeCompare(\"radiation\") === 0) {\r\n              return (\r\n                <Radiation\r\n                  key={`${calamity.id}+calamity`}\r\n                  size={calamity.size}\r\n                  amplitude={calamity.amplitude}\r\n                  duration={calamity.duration}\r\n                  position={calamity.position}\r\n                />\r\n              );\r\n            }\r\n          })\r\n        : null}\r\n      {earthRef && earthDimensions\r\n        ? creatures.map((creature) => {\r\n            return (\r\n              <Creature\r\n                birth={creature.birth}\r\n                key={creature.uid}\r\n                uid={creature.uid}\r\n                earthRef={earthRef}\r\n                dim={earthDimensions}\r\n                x={creature.x}\r\n                y={creature.y}\r\n                size={creature.size}\r\n                gender={creature.gender}\r\n              ></Creature>\r\n            );\r\n          })\r\n        : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Earth;\r\n"]},"metadata":{},"sourceType":"module"}